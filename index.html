<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaki Menu - H·ªá th·ªëng ƒë·∫∑t m√≥n t·∫°i b√†n</title>

    <style>
        .card.ordered-flag {
            border: 2px solid red;
            box-shadow: 0 0 12px rgba(255, 0, 0, 0.5);
        }


        #orderedPanel {
            position: fixed;
            top: 0;
            right: 0;
            width: 360px;
            height: 100vh;
            background: rgba(25, 25, 25, 0.7);
            backdrop-filter: blur(30px);
            padding: 22px;
            border-left: none;
            overflow-y: auto;
            z-index: 998;
            transform: translateX(100%);
            transition: 0.35s ease;
        }

        /* N·ª≠a tr√™n - ch·∫°y t·ª´ gi·ªØa l√™n */
        #orderedPanel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 50%;
            background: linear-gradient(0deg,
                    #ff0000, #ff7f00, #ffff00, #00ff00,
                    #00ffff, #0000ff, #8b00ff, #ff00ff,
                    #ff0000, #ff7f00, #ffff00, #00ff00);
            background-size: 100% 300%;
            animation: rgbWaveUp 2s linear infinite;
        }

        /* N·ª≠a d∆∞·ªõi - ch·∫°y t·ª´ gi·ªØa xu·ªëng */
        #orderedPanel::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 3px;
            height: 50%;
            background: linear-gradient(180deg,
                    #ff0000, #ff7f00, #ffff00, #00ff00,
                    #00ffff, #0000ff, #8b00ff, #ff00ff,
                    #ff0000, #ff7f00, #ffff00, #00ff00);
            background-size: 100% 300%;
            animation: rgbWaveDown 2s linear infinite;
        }

        #orderedPanel.show {
            transform: translateX(0);
        }


        #customAlertOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.55);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(3px);
        }

        #customAlertBox {
            background: #1f1f1f;
            padding: 28px 30px;
            border-radius: 14px;
            width: 330px;
            text-align: center;
            color: #fff;
            border: 1.5px solid rgba(255, 100, 100, 0.35);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.45);
            animation: alertPop 0.35s ease forwards;
            opacity: 0;
            transform: scale(0.7);
        }

        @keyframes alertPop {
            0% {
                opacity: 0;
                transform: scale(0.7);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* ===== CUSTOM CONFIRM ===== */
        #customConfirmOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(3px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2001;
        }

        #customConfirmBox {
            background: #1f1f1f;
            padding: 28px 30px;
            border-radius: 14px;
            width: 350px;
            text-align: center;
            color: #fff;
            border: 1.5px solid rgba(255, 100, 100, 0.35);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.45);
            animation: alertPop 0.35s ease forwards;
            opacity: 0;
            transform: scale(0.7);
        }

        .confirm-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .confirm-btn {
            flex: 1;
            padding: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.25s;
        }

        #confirmCancelBtn {
            background: rgba(255, 255, 255, 0.1);
        }

        #confirmCancelBtn:hover {
            transform: scale(1.05);
        }

        #confirmOkBtn {
            background: linear-gradient(45deg, #ff4d4d, #ffa64d);
            color: #fff;
        }

        #confirmOkBtn:hover {
            transform: scale(1.07);
        }



        #alertOkBtn {
            margin-top: 20px;
            padding: 10px 22px;
            background: linear-gradient(45deg, #ff4d4d, #ffa64d);
            border-radius: 10px;
            cursor: pointer;
            display: inline-block;
            color: #fff;
            font-weight: bold;
            transition: 0.25s;
        }

        #alertOkBtn:hover {
            transform: scale(1.06);
        }



        /*===================Th√πng r√°C=================================*/

        .cart-clear-btn {
            font-size: 22px;
            color: #ff0000;
            cursor: pointer;
            margin-right: 14px;
        }

        .cart-item-delete {
            font-size: 18px;
            color: #bbbbbb;
            cursor: pointer;
            margin-left: 10px;
        }

        .cart-item-delete:hover {
            color: #ff5b5b;
        }




        /*=========================√î s·ªë l∆∞·ª£ng trong gi·ªè h√†ng===================*/
        .cartQtyInput {
            width: 50px;
            padding: 6px;
            margin-left: 6px;
            margin-right: 6px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #888;
            border-radius: 6px;
            color: #fff;
            text-align: center;
            /* ·∫®n m≈©i t√™n l√™n/xu·ªëng */
            -moz-appearance: textfield;
            -webkit-appearance: none;
            appearance: none;
        }

        .cartQtyInput::-webkit-inner-spin-button,
        .cartQtyInput::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .cart-qty-row {
            display: flex;
            align-items: center;
            margin-top: 6px;
        }

        .cart-qty-btn {
            width: 28px;
            height: 28px;
            background: rgba(80, 80, 80, 0.6);
            border: 1px solid #666;
            border-radius: 6px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .cart-qty-btn:hover {
            background: rgba(255, 100, 100, 0.4);
        }

        .cart-qty-btn:active {
            transform: scale(0.95);
        }


        /* ======================= GLOBAL ======================= */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: radial-gradient(circle at 20% 30%, #1b1b1b, #0c0c0c 70%);
            color: #fff;
            overflow-x: hidden;
        }

        /* ======================= HEADER ======================= */
        header {
            position: relative;
            padding: 18px 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: none;
        }

        /* N·ª≠a tr√°i - ch·∫°y t·ª´ gi·ªØa sang tr√°i */
        header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50%;
            height: 3px;
            background: linear-gradient(270deg,
                    #ff0000, #ff7f00, #ffff00, #00ff00,
                    #00ffff, #0000ff, #8b00ff, #ff00ff,
                    #ff0000, #ff7f00, #ffff00, #00ff00);
            background-size: 300% 100%;
            animation: rgbWaveLeft 2s linear infinite;
        }

        /* N·ª≠a ph·∫£i - ch·∫°y t·ª´ gi·ªØa sang ph·∫£i */
        header::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg,
                    #ff0000, #ff7f00, #ffff00, #00ff00,
                    #00ffff, #0000ff, #8b00ff, #ff00ff,
                    #ff0000, #ff7f00, #ffff00, #00ff00);
            background-size: 300% 100%;
            animation: rgbWaveRight 2s linear infinite;
        }

        .logo {
            font-size: 26px;
            font-weight: bold;
            background: linear-gradient(90deg, #ff4d4d, #ff914d);
            -webkit-background-clip: text;
            color: transparent;
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        select,
        button {
            padding: 8px 12px;
            border-radius: 10px;
            background: rgba(40, 40, 40, 0.6);
            color: #fff;
            border: 1px solid rgba(90, 90, 90, 0.5);
        }

        /* Ordered button multi-line styling */
        #orderedBtn {
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.3;
            padding: 6px 10px;
        }

        #orderedBtnTotal {
            font-size: 11px;
            color: #ffa64d;
            font-weight: bold;
            margin-top: 2px;
        }

        /* Mobile Header */
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                gap: 10px;
            }

            .header-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* ======================= TABS ======================= */
        .tabs {
            display: flex;
            overflow-x: auto;
            gap: 22px;
            padding: 12px 20px;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 12px 22px;
            color: #ccc;
            cursor: pointer;
            white-space: nowrap;
            transition: transform 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab:hover {
            transform: translateY(-6px) scale(1.05);
            color: #ff7b7b;
            box-shadow: 0 10px 25px rgba(255, 77, 77, 0.35);
            background: rgba(255, 77, 77, 0.08);
        }

        .tab.active {
            color: #ff7b7b;
            border-bottom: 2px solid #ff7b7b;
            background: rgba(255, 77, 77, 0.1);
        }


        /* ======================= MENU GRID ======================= */
        .container {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 26px;
        }

        @media (max-width: 1100px) {
            .container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 800px) {
            .container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 550px) {
            .container {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        /* ======================= CARD (UPGRADED) ======================= */
        .card {
            position: relative;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(18px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0px 6px 18px rgba(0, 0, 0, 0.35);
            transition: transform .25s ease, box-shadow .25s ease;
            padding: 16px;
            /* kho·∫£ng c√°ch b√™n trong card */
        }

        .card:hover {
            transform: translateY(-6px) scale(1.015);
            box-shadow: 0 12px 28px rgba(255, 60, 60, 0.35);
        }


        .card img {
            width: 100%;
            height: 190px;
            object-fit: cover;
            transition: transform .35s ease;
        }

        /* Zoom ·∫£nh nh·∫π khi hover */
        .card:hover img {
            transform: scale(1.07);
        }


        .qty-row {
            margin-top: 14px;
            display: flex;
            align-items: center;
        }

        .qty-btn {
            width: 34px;
            height: 34px;
            background: rgba(80, 80, 80, 0.5);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
        }

        .add-cart-btn {
            margin-left: auto;
            background: linear-gradient(45deg, #ff4d4d, #ffa04d);
            padding: 8px 18px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }


        /* Card ƒë∆∞·ª£c ch·ªçn (ƒë√£ c√≥ trong gi·ªè) */
        .card.selected {
            border: 2px solid #4ade80;
            /* xanh l√° */
            box-shadow: 0 0 12px rgba(74, 222, 128, 0.6);
            position: relative;
        }

        /* Icon tick */
        .card .tick-mark {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4ade80;
            color: #000;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
        }



        /* ======================= CART PANEL ======================= */
        #cartPanel {
            position: fixed;
            top: 0;
            right: 0;
            width: 360px;
            max-width: 100%;
            height: 100vh;
            background: rgba(25, 25, 25, 0.7);
            backdrop-filter: blur(30px);
            padding: 22px;
            border-left: none;
            overflow-y: auto;
            z-index: 999;
            transform: translateX(100%);
            transition: transform 0.35s ease;
        }

        /* N·ª≠a tr√™n - ch·∫°y t·ª´ gi·ªØa l√™n */
        #cartPanel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 50%;
            background: linear-gradient(0deg,
                    #ff0000, #ff7f00, #ffff00, #00ff00,
                    #00ffff, #0000ff, #8b00ff, #ff00ff,
                    #ff0000, #ff7f00, #ffff00, #00ff00);
            background-size: 100% 300%;
            animation: rgbWaveUp 2s linear infinite;
        }

        /* N·ª≠a d∆∞·ªõi - ch·∫°y t·ª´ gi·ªØa xu·ªëng */
        #cartPanel::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 3px;
            height: 50%;
            background: linear-gradient(180deg,
                    #ff0000, #ff7f00, #ffff00, #00ff00,
                    #00ffff, #0000ff, #8b00ff, #ff00ff,
                    #ff0000, #ff7f00, #ffff00, #00ff00);
            background-size: 100% 300%;
            animation: rgbWaveDown 2s linear infinite;
        }

        #cartPanel.show {
            transform: translateX(0);
        }

        .close-cart {
            font-size: 28px;
            color: #ff8080;
            cursor: pointer;
            text-align: right;
        }

        .cart-item {
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        #orderBtn {
            width: 100%;
            margin-top: 18px;
            padding: 13px;
            background: linear-gradient(45deg, #ff4d4d, #ff9f4d);
            border-radius: 12px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
        }

        /* ======================= RGB WAVE EFFECT ======================= */
        @keyframes rgbWave {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* RGB Wave ch·∫°y sang tr√°i (t·ª´ gi·ªØa ra) */
        @keyframes rgbWaveLeft {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 100% 50%;
            }
        }

        /* RGB Wave ch·∫°y sang ph·∫£i (t·ª´ gi·ªØa ra) */
        @keyframes rgbWaveRight {
            0% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* RGB Wave ch·∫°y l√™n tr√™n (t·ª´ gi·ªØa ra) */
        @keyframes rgbWaveUp {
            0% {
                background-position: 50% 0%;
            }

            100% {
                background-position: 50% 100%;
            }
        }

        /* RGB Wave ch·∫°y xu·ªëng d∆∞·ªõi (t·ª´ gi·ªØa ra) */
        @keyframes rgbWaveDown {
            0% {
                background-position: 50% 100%;
            }

            100% {
                background-position: 50% 0%;
            }
        }


        /* ======================= SHAKE ======================= */
        @keyframes shake {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }


        .qty-input {
            width: 55px;
            padding: 6px 8px;
            text-align: center;
            background: rgba(80, 80, 80, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 16px;

            /* Lo·∫°i b·ªè m≈©i t√™n tƒÉng/gi·∫£m */
            -moz-appearance: textfield;
        }

        .qty-input::-webkit-inner-spin-button,
        .qty-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }


        .qty-input::-webkit-inner-spin-button,
        .qty-input::-webkit-outer-spin-button {
            opacity: 1;
        }

        /* ======================= AI CHATBOT ======================= */
        #aiChatBtn {
            position: fixed;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #a855f7 35%, #ec4899 70%, #f97316 100%);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #aiChatBtn:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.6);
        }

        #aiChatBtn .ai-icon {
            font-size: 18px;
            display: inline-block;
            animation: robotBounce 1s ease-in-out infinite, robotWiggle 2s ease-in-out infinite;
        }

        #aiChatBtnText {
            background: linear-gradient(90deg,
                    #00FFFF,
                    #FFFF00,
                    #7FFF00,
                    #00FFFF,
                    #FFD700,
                    #39FF14,
                    #00FFFF);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientTextFlow 2s linear infinite;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        @keyframes gradientTextFlow {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 100% 50%;
            }
        }

        @keyframes robotBounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-3px);
            }
        }

        @keyframes robotWiggle {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-2px) rotate(-5deg);
            }

            50% {
                transform: translateY(-3px) rotate(0deg);
            }

            75% {
                transform: translateY(-2px) rotate(5deg);
            }
        }

        #aiChatPanel {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            width: 380px;
            max-width: 95%;
            height: 500px;
            max-height: 70vh;
            background: rgba(30, 30, 40, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        #aiChatPanel.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) scale(1);
        }

        .ai-chat-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #a855f7 35%, #ec4899 70%, #f97316 100%);
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-header h3 {
            margin: 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-chat-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: #fff;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .ai-chat-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ai-message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-message.bot {
            background: linear-gradient(135deg, #667eea 0%, #a855f7 50%, #ec4899 100%);
            color: #fff;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .ai-message.user {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .ai-message.thinking {
            background: rgba(168, 85, 247, 0.3);
            color: #aaa;
        }

        .ai-message.thinking::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {

            0%,
            20% {
                content: '.';
            }

            40% {
                content: '..';
            }

            60%,
            100% {
                content: '...';
            }
        }

        .ai-quick-responses {
            display: flex;
            gap: 10px;
            padding: 10px 15px;
            justify-content: center;
        }

        .ai-quick-btn {
            padding: 10px 25px;
            border-radius: 25px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-quick-btn.yes {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: #fff;
        }

        .ai-quick-btn.no {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            color: #fff;
        }

        .ai-quick-btn:hover {
            transform: scale(1.05);
        }

        .ai-chat-input {
            display: flex;
            padding: 15px;
            gap: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-chat-input input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .ai-chat-input input:focus {
            border-color: #a855f7;
        }

        .ai-chat-input input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .ai-chat-input button {
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            color: #fff;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .ai-chat-input button:hover {
            transform: scale(1.05);
        }

        .ai-recommendations {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 10px;
            margin-top: 8px;
        }

        .ai-rec-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-rec-item:last-child {
            border-bottom: none;
        }

        .ai-rec-total {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: bold;
            text-align: right;
        }

        /* ======================= KAHOOT-STYLE ANIMATED FOOD ICONS BACKGROUND ======================= */
        .food-icons-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .food-icon {
            position: absolute;
            font-size: 3rem;
            opacity: 0.18;
            animation: floatIcon 6s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.25));
        }

        /* Randomized positions and delays for each icon */
        .food-icon:nth-child(1) {
            left: 5%;
            top: 10%;
            animation-delay: 0s;
            animation-duration: 7s;
            font-size: 3.8rem;
        }

        .food-icon:nth-child(2) {
            left: 15%;
            top: 30%;
            animation-delay: 2s;
            animation-duration: 8s;
            font-size: 2.8rem;
        }

        .food-icon:nth-child(3) {
            left: 25%;
            top: 60%;
            animation-delay: 4s;
            animation-duration: 6s;
            font-size: 3.3rem;
        }

        .food-icon:nth-child(4) {
            left: 35%;
            top: 20%;
            animation-delay: 1s;
            animation-duration: 9s;
            font-size: 3rem;
        }

        .food-icon:nth-child(5) {
            left: 45%;
            top: 80%;
            animation-delay: 3s;
            animation-duration: 7s;
            font-size: 3.5rem;
        }

        .food-icon:nth-child(6) {
            left: 55%;
            top: 45%;
            animation-delay: 5s;
            animation-duration: 8s;
            font-size: 2.9rem;
        }

        .food-icon:nth-child(7) {
            left: 65%;
            top: 15%;
            animation-delay: 0.5s;
            animation-duration: 8s;
            font-size: 3.6rem;
        }

        .food-icon:nth-child(8) {
            left: 75%;
            top: 70%;
            animation-delay: 2.5s;
            animation-duration: 7s;
            font-size: 3.2rem;
        }

        .food-icon:nth-child(9) {
            left: 85%;
            top: 35%;
            animation-delay: 4.5s;
            animation-duration: 8s;
            font-size: 2.7rem;
        }

        .food-icon:nth-child(10) {
            left: 92%;
            top: 55%;
            animation-delay: 1.5s;
            animation-duration: 6s;
            font-size: 3.3rem;
        }

        .food-icon:nth-child(11) {
            left: 8%;
            top: 75%;
            animation-delay: 3.5s;
            animation-duration: 9s;
            font-size: 3rem;
        }

        .food-icon:nth-child(12) {
            left: 20%;
            top: 5%;
            animation-delay: 6s;
            animation-duration: 8s;
            font-size: 2.8rem;
        }

        .food-icon:nth-child(13) {
            left: 40%;
            top: 50%;
            animation-delay: 0.8s;
            animation-duration: 7s;
            font-size: 3.5rem;
        }

        .food-icon:nth-child(14) {
            left: 60%;
            top: 85%;
            animation-delay: 2.8s;
            animation-duration: 8s;
            font-size: 3rem;
        }

        .food-icon:nth-child(15) {
            left: 80%;
            top: 8%;
            animation-delay: 5.5s;
            animation-duration: 7s;
            font-size: 3.8rem;
        }

        .food-icon:nth-child(16) {
            left: 3%;
            top: 45%;
            animation-delay: 1.2s;
            animation-duration: 9s;
            font-size: 2.9rem;
        }

        .food-icon:nth-child(17) {
            left: 30%;
            top: 90%;
            animation-delay: 4.2s;
            animation-duration: 6s;
            font-size: 3.2rem;
        }

        .food-icon:nth-child(18) {
            left: 50%;
            top: 25%;
            animation-delay: 0.3s;
            animation-duration: 8s;
            font-size: 3.6rem;
        }

        .food-icon:nth-child(19) {
            left: 70%;
            top: 40%;
            animation-delay: 3.2s;
            animation-duration: 8s;
            font-size: 2.8rem;
        }

        .food-icon:nth-child(20) {
            left: 88%;
            top: 75%;
            animation-delay: 5.8s;
            animation-duration: 7s;
            font-size: 3.3rem;
        }

        /* Additional icons 21-35 */
        .food-icon:nth-child(21) {
            left: 12%;
            top: 55%;
            animation-delay: 1.8s;
            animation-duration: 8s;
            font-size: 3.4rem;
        }

        .food-icon:nth-child(22) {
            left: 28%;
            top: 15%;
            animation-delay: 4.8s;
            animation-duration: 8s;
            font-size: 2.9rem;
        }

        .food-icon:nth-child(23) {
            left: 38%;
            top: 72%;
            animation-delay: 0.6s;
            animation-duration: 7s;
            font-size: 3.7rem;
        }

        .food-icon:nth-child(24) {
            left: 52%;
            top: 8%;
            animation-delay: 3.8s;
            animation-duration: 8s;
            font-size: 3.1rem;
        }

        .food-icon:nth-child(25) {
            left: 68%;
            top: 62%;
            animation-delay: 2.2s;
            animation-duration: 7s;
            font-size: 3.5rem;
        }

        .food-icon:nth-child(26) {
            left: 78%;
            top: 28%;
            animation-delay: 5.2s;
            animation-duration: 9s;
            font-size: 2.8rem;
        }

        .food-icon:nth-child(27) {
            left: 95%;
            top: 18%;
            animation-delay: 1.4s;
            animation-duration: 6s;
            font-size: 3.2rem;
        }

        .food-icon:nth-child(28) {
            left: 2%;
            top: 88%;
            animation-delay: 4.4s;
            animation-duration: 8s;
            font-size: 3.6rem;
        }

        .food-icon:nth-child(29) {
            left: 22%;
            top: 42%;
            animation-delay: 0.9s;
            animation-duration: 8s;
            font-size: 3rem;
        }

        .food-icon:nth-child(30) {
            left: 48%;
            top: 68%;
            animation-delay: 3.4s;
            animation-duration: 7s;
            font-size: 3.4rem;
        }

        .food-icon:nth-child(31) {
            left: 58%;
            top: 12%;
            animation-delay: 6.2s;
            animation-duration: 8s;
            font-size: 2.9rem;
        }

        .food-icon:nth-child(32) {
            left: 72%;
            top: 88%;
            animation-delay: 2.6s;
            animation-duration: 7s;
            font-size: 3.7rem;
        }

        .food-icon:nth-child(33) {
            left: 82%;
            top: 48%;
            animation-delay: 5s;
            animation-duration: 9s;
            font-size: 3.1rem;
        }

        .food-icon:nth-child(34) {
            left: 18%;
            top: 68%;
            animation-delay: 1.6s;
            animation-duration: 6s;
            font-size: 3.5rem;
        }

        .food-icon:nth-child(35) {
            left: 42%;
            top: 38%;
            animation-delay: 4s;
            animation-duration: 8s;
            font-size: 3.3rem;
        }

        @keyframes floatIcon {

            0%,
            100% {
                transform: translateY(0) rotate(0deg) scale(1);
            }

            25% {
                transform: translateY(-60px) rotate(15deg) scale(1.15);
            }

            50% {
                transform: translateY(-35px) rotate(-10deg) scale(1.08);
            }

            75% {
                transform: translateY(-80px) rotate(-15deg) scale(0.92);
            }
        }

        /* Additional subtle animations for odd icons */
        .food-icon:nth-child(odd) {
            animation-name: floatIconAlt;
        }

        @keyframes floatIconAlt {

            0%,
            100% {
                transform: translateY(0) rotate(0deg) scale(1);
            }

            25% {
                transform: translateY(-45px) rotate(-12deg) scale(0.92);
            }

            50% {
                transform: translateY(-75px) rotate(8deg) scale(1.12);
            }

            75% {
                transform: translateY(-35px) rotate(18deg) scale(1.05);
            }
        }

        /* Pulse effect for every 3rd icon */
        .food-icon:nth-child(3n) {
            animation: floatIconPulse 7s ease-in-out infinite;
        }

        @keyframes floatIconPulse {

            0%,
            100% {
                transform: translateY(0) rotate(0deg) scale(1);
                opacity: 0.12;
            }

            25% {
                transform: translateY(-55px) rotate(12deg) scale(1.18);
                opacity: 0.25;
            }

            50% {
                transform: translateY(-30px) rotate(-10deg) scale(1.05);
                opacity: 0.18;
            }

            75% {
                transform: translateY(-70px) rotate(-18deg) scale(1.12);
                opacity: 0.22;
            }
        }
    </style>
</head>


<body>

    <!-- KAHOOT-STYLE ANIMATED FOOD ICONS BACKGROUND -->
    <div class="food-icons-bg">
        <span class="food-icon">üçï</span>
        <span class="food-icon">üçî</span>
        <span class="food-icon">üçú</span>
        <span class="food-icon">üç£</span>
        <span class="food-icon">üç©</span>
        <span class="food-icon">üç∫</span>
        <span class="food-icon">üç±</span>
        <span class="food-icon">üåÆ</span>
        <span class="food-icon">üç¶</span>
        <span class="food-icon">‚òï</span>
        <span class="food-icon">üç∑</span>
        <span class="food-icon">ü•ó</span>
        <span class="food-icon">üçó</span>
        <span class="food-icon">üßÅ</span>
        <span class="food-icon">ü•ü</span>
        <span class="food-icon">üçø</span>
        <span class="food-icon">ü•§</span>
        <span class="food-icon">üç≤</span>
        <span class="food-icon">üç∞</span>
        <span class="food-icon">ü•©</span>
        <!-- Additional icons 21-35 -->
        <span class="food-icon">üçù</span>
        <span class="food-icon">ü•ò</span>
        <span class="food-icon">üçõ</span>
        <span class="food-icon">üç§</span>
        <span class="food-icon">ü•ß</span>
        <span class="food-icon">üç™</span>
        <span class="food-icon">üç°</span>
        <span class="food-icon">üßá</span>
        <span class="food-icon">üçû</span>
        <span class="food-icon">ü•ê</span>
        <span class="food-icon">üç≥</span>
        <span class="food-icon">ü•ì</span>
        <span class="food-icon">üçü</span>
        <span class="food-icon">üåØ</span>
        <span class="food-icon">ü•™</span>
    </div>

    <!-- AI CHATBOT BUTTON -->
    <button id="aiChatBtn" onclick="toggleAiChat()">
        <span class="ai-icon">ü§ñ</span>
        <span id="aiChatBtnText">Tr·ª£ l√Ω AI</span>
    </button>

    <!-- AI CHATBOT PANEL -->
    <div id="aiChatPanel">
        <div class="ai-chat-header">
            <h3><span>ü§ñ</span> <span id="aiChatTitle">Tr·ª£ l√Ω g·ª£i √Ω m√≥n</span></h3>
            <button class="ai-chat-close" onclick="toggleAiChat()">‚úï</button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages"></div>
        <div class="ai-quick-responses" id="aiQuickResponses" style="display: none;">
            <button class="ai-quick-btn yes" onclick="handleQuickResponse(1)"><span id="aiYesText">C√≥</span></button>
            <button class="ai-quick-btn no" onclick="handleQuickResponse(0)"><span id="aiNoText">Kh√¥ng</span></button>
        </div>
        <div class="ai-chat-input" id="aiChatInputArea">
            <input type="text" id="aiChatInput" placeholder="Nh·∫≠p tin nh·∫Øn..."
                onkeypress="if(event.key==='Enter')sendAiMessage()">
            <button onclick="sendAiMessage()" id="aiSendBtn">G·ª≠i</button>
        </div>
    </div>

    <header>
        <div class="logo">üî• Yaki</div>

        <div class="header-controls">
            <select id="langSelect">
                <option>Ti·∫øng Vi·ªát</option>
                <option>English</option>
                <option>‰∏≠Êñá</option>
                <option>Êó•Êú¨Ë™û</option>
                <option>ÌïúÍµ≠Ïñ¥</option>
            </select>

            <span id="tableDisplay"
                style="padding: 8px 12px; border-radius: 10px; background: rgba(40, 40, 40, 0.6); color: #fff; border: 1px solid rgba(90, 90, 90, 0.5);">B√†n
                1</span>

            <button onclick="toggleCart()">üõí
                <span id="cartBtnText">Gi·ªè</span>
                (<span id="cartCount">0</span>)
            </button>

            <button id="orderedBtn" onclick="toggleOrdered()">
                <div>üîî
                    <span id="orderedText">ƒê√£ g·ªçi</span>
                    (<span id="orderedCount">0</span>)
                </div>
                <div id="orderedBtnTotal">0 ƒë</div>
        </div>
    </header>

    <!-- TABS (dynamically loaded from Firestore) -->
    <div class="tabs" id="tabsContainer">
        <!-- Tabs will be loaded dynamically -->
    </div>

    <!-- MENU -->
    <div id="menuList" class="container"></div>

    <!-- CART -->
    <div id="cartPanel">
        <div style="display:flex; justify-content: space-between; align-items:center;">
            <div class="cart-clear-btn" onclick="clearCart()">üóëÔ∏è</div>
            <div class="close-cart" onclick="toggleCart()">‚úñ</div>
        </div>

        <h2 id="cartTitle">Gi·ªè h√†ng</h2>
        <div id="cartItems"></div>
        <h3 style="margin-top:20px">
            <span id="totalLabel">T·ªïng</span>:
            <span id="totalPrice">0</span> ƒë
        </h3>
        <div id="orderBtn" onclick="placeOrder()">X√°c nh·∫≠n ƒë·∫∑t m√≥n</div>
    </div>

    <div id="orderedPanel">
        <div class="close-cart" onclick="toggleOrdered()">‚úñ</div>

        <h2 id="orderedTitle">M√≥n ƒë√£ g·ªçi</h2>
        <div id="orderedItems"></div>

        <h3 style="margin-top:20px">
            <span id="orderedTotalLabel">T·ªïng</span>: <span id="orderedTotal">0</span> ƒë
        </h3>
    </div>


    <script>

        /* ======================= FIREBASE SETUP ======================= */
        // Firebase SDKs
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>

        const firebaseConfig = {
            apiKey: "AIzaSyCCTaXqidGM4DIyJnz1-zbg_6PdxmDpV30",
            authDomain: "food-order-at-table-to-kitchen.firebaseapp.com",
            projectId: "food-order-at-table-to-kitchen",
            storageBucket: "food-order-at-table-to-kitchen.firebasestorage.app",
            messagingSenderId: "179233667372",
            appId: "1:179233667372:web:76170af27a89ff778a9489"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /* ======================= FIREBASE LISTENER ======================= */
        function listenToTableOrders() {
            const tableId = `table_${currentTableId}`;
            console.log('üîä Starting Firebase listener for:', tableId);

            db.collection("tables").doc(tableId).onSnapshot((doc) => {
                console.log('üì• Firebase update received:', doc.exists ? doc.data() : 'no data');

                if (doc.exists) {
                    const data = doc.data();
                    const firebaseOrders = data.orders || [];

                    // Convert Firebase orders array to orderedItems object
                    // Aggregate items with same ID
                    orderedItems = {};
                    firebaseOrders.forEach(item => {
                        if (!orderedItems[item.id]) {
                            orderedItems[item.id] = { ...item };
                        } else {
                            orderedItems[item.id].qty += item.qty;
                        }
                    });

                    console.log('üìã Updated orderedItems:', orderedItems);

                    renderOrderedItems();
                    renderMenu(); // Update red border on ordered items
                } else {
                    // Table doesn't exist in Firebase yet - clear ordered items
                    orderedItems = {};
                    renderOrderedItems();
                    renderMenu();
                }
            });
        }

        function renderOrderedItems() {
            const box = document.getElementById("orderedItems");
            box.innerHTML = "";

            let total = 0;

            for (let id in orderedItems) {
                const item = orderedItems[id];
                total += item.qty * item.price;

                box.innerHTML += `
            <div class="cart-item">
                <b>${item.name[currentLang]}</b><br>
                ${translations[currentLang].ordered.qty}: ${item.qty} √ó ${item.price.toLocaleString()} ƒë
            </div>
        `;
            }

            document.getElementById("orderedTotal").innerText = total.toLocaleString();
            document.getElementById("orderedCount").innerText =
                Object.values(orderedItems).reduce((a, b) => a + b.qty, 0);

            // Update total in header button
            document.getElementById("orderedBtnTotal").innerText = total.toLocaleString() + " ƒë";
        }


        /*=======================custom alert=========================*/
        function showAlert(msg) {
            const overlay = document.getElementById("customAlertOverlay");
            const box = document.getElementById("customAlertBox");

            document.getElementById("alertMessage").innerText = msg;

            overlay.style.display = "flex";

            // Reset animation ƒë·ªÉ ch·∫°y l·∫°i m∆∞·ª£t
            box.style.animation = "none";
            void box.offsetWidth; // trick restart animation
            box.style.animation = "alertPop 0.35s ease forwards";
        }

        function closeAlert() {
            const overlay = document.getElementById("customAlertOverlay");
            overlay.style.display = "none";
        }

        /* ======================= CUSTOM CONFIRM ======================= */
        let confirmCallback = null;

        function showConfirm(msg, callback) {
            confirmCallback = callback;

            // Hi·ªÉn th·ªã n·ªôi dung confirm
            document.getElementById("confirmMessage").innerText = msg;

            // C·∫≠p nh·∫≠t n√∫t theo ng√¥n ng·ªØ hi·ªán t·∫°i
            document.getElementById("confirmCancelBtn").innerText = translations[currentLang].confirm.cancel;
            document.getElementById("confirmOkBtn").innerText = translations[currentLang].confirm.ok;

            const overlay = document.getElementById("customConfirmOverlay");
            const box = document.getElementById("customConfirmBox");

            overlay.style.display = "flex";

            // Reset animation ƒë·ªÉ ch·∫°y l·∫°i m∆∞·ª£t
            box.style.animation = "none";
            void box.offsetWidth; // trick restart animation
            box.style.animation = "alertPop 0.35s ease forwards";
        }

        function closeConfirm(result) {
            // ·∫®n overlay
            document.getElementById("customConfirmOverlay").style.display = "none";

            // Ch·ªâ g·ªçi callback n·∫øu c√≥
            if (confirmCallback) confirmCallback(result);
        }

        /* ======================= CLEAR CART ======================= */
        function clearCart() {
            // Hi·ªÉn th·ªã confirm tr∆∞·ªõc khi x√≥a to√†n b·ªô gi·ªè h√†ng
            showConfirm(translations[currentLang].confirm.clearAll, function (ok) {

                if (!ok) return; // Nh·∫•n Cancel ‚Üí gi·ªØ nguy√™n tr·∫°ng th√°i

                // N·∫øu nh·∫•n OK ‚Üí x√≥a to√†n b·ªô
                for (let id in cart) {
                    cart[id].qty = 0;
                    cart[id].tempQty = 0;
                }

                updateCart();
                renderMenu();
            });
        }


        /*=======================x√≥a t·ª´ng m√≥n=========================*/

        function deleteItem(id) {
            cart[id].qty = 0;
            cart[id].tempQty = 0;

            updateCart();
            renderMenu();
        }


        /*=================x√≥a to√†n b·ªô gi·ªè h√†ng=======================*/

        function clearCart() {
            showConfirm(translations[currentLang].confirm.clearAll, function (ok) {

                if (!ok) return; // Nh·∫•n Cancel ‚Üí kh√¥ng l√†m g√¨

                // Nh·∫•n OK ‚Üí x√≥a to√†n b·ªô gi·ªè h√†ng
                for (let id in cart) {
                    cart[id].qty = 0;
                    cart[id].tempQty = 0;
                }

                updateCart();
                renderMenu();
            });
        }





        /*==================Ch·ª©c nƒÉng cho √¥ s·ªë l∆∞·ª£ng gi·ªè h√†ng========*/

        let cartQtyTimeout = null; // Debounce timer

        function changeCartQty(input) {
            const id = input.dataset.id;
            let newQty = input.value;

            // R·ªóng ‚Üí kh√¥ng c·∫≠p nh·∫≠t g√¨ (ƒë·ªÉ user nh·∫≠p ti·∫øp)
            if (newQty === "") return;

            newQty = Number(newQty);
            if (newQty < 0) newQty = 0;

            // C·∫≠p nh·∫≠t data ngay nh∆∞ng KH√îNG render l·∫°i cart
            cart[id].qty = newQty;
            cart[id].tempQty = newQty;

            // Clear timeout c≈©
            if (cartQtyTimeout) clearTimeout(cartQtyTimeout);

            // Debounce: Ch·ªù 400ms sau khi ng·ª´ng g√µ m·ªõi render
            cartQtyTimeout = setTimeout(() => {
                if (newQty === 0) {
                    // X√≥a kh·ªèi gi·ªè
                    updateCart();
                    renderMenu();
                } else {
                    // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn v√† s·ªë l∆∞·ª£ng hi·ªÉn th·ªã
                    updateCartTotals();
                    renderMenu();
                }
            }, 400);
        }

        // H√†m ch·ªâ c·∫≠p nh·∫≠t t·ªïng ti·ªÅn m√† KH√îNG render l·∫°i cart items
        function updateCartTotals() {
            let total = 0, count = 0;

            for (let id in cart) {
                if (cart[id].qty > 0) {
                    total += cart[id].qty * cart[id].price;
                    count += cart[id].qty;
                }
            }

            document.getElementById("totalPrice").innerText = total.toLocaleString();
            document.getElementById("cartCount").innerText = count;
        }

        // H√†m x·ª≠ l√Ω khi nh·∫•n n√∫t +/- trong gi·ªè h√†ng
        function changeCartQtyBtn(id, delta) {
            let newQty = Math.max(0, (cart[id].qty || 0) + delta);

            cart[id].qty = newQty;
            cart[id].tempQty = newQty;

            if (newQty === 0) {
                // X√≥a kh·ªèi gi·ªè
                updateCart();
                renderMenu();
            } else {
                // C·∫≠p nh·∫≠t gi·ªè h√†ng v√† menu
                updateCart();
                renderMenu();
            }
        }


        /* ======================= NG√îN NG·ªÆ ======================= */
        const translations = {
            vi: {
                tabs: { nuong: "M√≥n n∆∞·ªõng", lau: "L·∫©u", mon_phu: "M√≥n ph·ª•", nuoc: "ƒê·ªì u·ªëng", khai_vi: "Khai v·ªã", trang_mieng: "Tr√°ng mi·ªáng" },
                buttons: { add: "Th√™m", order: "X√°c nh·∫≠n ƒë·∫∑t m√≥n", cart: "Gi·ªè", ordered: "ƒê√£ g·ªçi" },
                messages: {
                    orderSent: "ƒê∆°n ƒë√£ g·ª≠i t·ªõi b·∫øp!",
                    emptyCart: "Gi·ªè h√†ng tr·ªëng!"
                },
                cart: { title: "Gi·ªè h√†ng", total: "T·ªïng", qty: "SL" },
                ordered: { title: "M√≥n ƒë√£ g·ªçi", total: "T·ªïng", qty: "SL" },
                table: "B√†n",
                confirm: {
                    clearAll: "X√≥a to√†n b·ªô gi·ªè h√†ng?",
                    cancel: "H·ªßy",
                    ok: "X√≥a"
                },
                chatbot: {
                    btnText: "Tr·ª£ l√Ω AI",
                    title: "Tr·ª£ l√Ω g·ª£i √Ω m√≥n",
                    greeting: "Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI c·ªßa Yaki. T√¥i s·∫Ω gi√∫p b·∫°n ch·ªçn m√≥n ƒÉn ph√π h·ª£p.",
                    askGuests: "B·∫°n c√≥ bao nhi√™u ng∆∞·ªùi ƒÉn?",
                    askBudget: "Ng√¢n s√°ch c·ªßa b·∫°n l√† bao nhi√™u? (VND)",
                    askAlcohol: "B·∫°n c√≥ mu·ªën d√πng ƒë·ªì u·ªëng c√≥ c·ªìn kh√¥ng?\nüëâ Nh·∫•n C√≥ = ƒê·ªìng √Ω, nh·∫•n Kh√¥ng = Kh√¥ng ƒë·ªìng √Ω",
                    thinking: "ƒêang suy nghƒ©",
                    recommendTitle: "ƒê√¢y l√† g·ª£i √Ω c·ªßa t√¥i cho b·∫°n:",
                    confirmAdd: "B·∫°n c√≥ mu·ªën th√™m c√°c m√≥n n√†y v√†o gi·ªè h√†ng?\nüëâ Nh·∫•n C√≥ = ƒê·ªìng √Ω, nh·∫•n Kh√¥ng = Kh√¥ng ƒë·ªìng √Ω",
                    addedToCart: "ƒê√£ th√™m t·∫•t c·∫£ m√≥n g·ª£i √Ω v√†o gi·ªè h√†ng! üéâ",
                    notAdded: "Kh√¥ng sao! B·∫°n c√≥ th·ªÉ t·ª± ch·ªçn m√≥n t·ª´ menu ho·∫∑c nh·ªù t√¥i g·ª£i √Ω l·∫°i.",
                    yes: "C√≥",
                    no: "Kh√¥ng",
                    total: "T·ªïng c·ªông",
                    inputPlaceholder: "Nh·∫≠p tin nh·∫Øn...",
                    send: "G·ª≠i",
                    error: "Xin l·ªói, ƒë√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i."
                }
            },
            en: {
                tabs: { nuong: "Grilled", lau: "Hotpot", mon_phu: "Side Dishes", nuoc: "Drinks", khai_vi: "Appetizer", trang_mieng: "Dessert" },
                buttons: { add: "Add", order: "Confirm Order", cart: "Cart", ordered: "Ordered" },
                messages: {
                    orderSent: "Order sent to kitchen!",
                    emptyCart: "Your cart is empty!"
                },
                cart: { title: "Cart", total: "Total", qty: "Qty" },
                ordered: { title: "Ordered Items", total: "Total", qty: "Qty" },
                table: "Table",
                confirm: {
                    clearAll: "Delete entire cart?",
                    cancel: "Cancel",
                    ok: "Delete"
                },
                chatbot: {
                    btnText: "AI Assistant",
                    title: "Food Suggestion Assistant",
                    greeting: "Hello! I'm Yaki's AI assistant. I'll help you choose the perfect dishes.",
                    askGuests: "How many people will be dining?",
                    askBudget: "What's your budget? (VND)",
                    askAlcohol: "Would you like alcoholic beverages?\nüëâ Press Yes = Agree, press No = Disagree",
                    thinking: "Thinking",
                    recommendTitle: "Here are my suggestions for you:",
                    confirmAdd: "Would you like to add these items to your cart?\nüëâ Press Yes = Agree, press No = Disagree",
                    addedToCart: "All suggested items have been added to your cart! üéâ",
                    notAdded: "No problem! You can browse the menu yourself or ask me for new suggestions.",
                    yes: "Yes",
                    no: "No",
                    total: "Total",
                    inputPlaceholder: "Type a message...",
                    send: "Send",
                    error: "Sorry, an error occurred. Please try again."
                }
            },
            zh: {
                tabs: { nuong: "ÁÉ§ËÇâ", lau: "ÁÅ´ÈîÖ", mon_phu: "Â∞èËèú", nuoc: "È•ÆÊñô", khai_vi: "ÈñãËÉÉËèú", trang_mieng: "ÁîúÈªû" },
                buttons: { add: "Ê∑ªÂä†", order: "Á¢∫Ë™çË®ÇÂñÆ", cart: "Ë¥≠Áâ©ËΩ¶", ordered: "Â∑≤ÁÇπËèú" },
                messages: {
                    orderSent: "ËÆ¢ÂçïÂ∑≤ÂèëÈÄÅÂà∞Âé®ÊàøÔºÅ",
                    emptyCart: "Ë≥ºÁâ©ËªäÊòØÁ©∫ÁöÑÔºÅ"
                },
                cart: { title: "Ë¥≠Áâ©ËΩ¶", total: "ÊÄªËÆ°", qty: "Êï∞Èáè" },
                ordered: { title: "Â∑≤ÁÇπËèúÂìÅ", total: "ÊÄªËÆ°", qty: "Êï∞Èáè" },
                table: "Ê°å",
                confirm: {
                    clearAll: "Âà™Èô§Êï¥ÂÄãË≥ºÁâ©ËªäÔºü",
                    cancel: "ÂèñÊ∂à",
                    ok: "Êì¶Èô§"
                },
                chatbot: {
                    btnText: "AIÂä©Êâã",
                    title: "ÁÇπÈ§êÊé®ËçêÂä©Êâã",
                    greeting: "ÊÇ®Â•ΩÔºÅÊàëÊòØYakiÁöÑAIÂä©Êâã„ÄÇÊàëÂ∞ÜÂ∏ÆÂä©ÊÇ®ÈÄâÊã©ÂêàÈÄÇÁöÑËèúÂìÅ„ÄÇ",
                    askGuests: "ËØ∑ÈóÆÊúâÂ§öÂ∞ë‰ΩçÁî®È§êÔºü",
                    askBudget: "ÊÇ®ÁöÑÈ¢ÑÁÆóÊòØÂ§öÂ∞ëÔºü(Ë∂äÂçóÁõæ)",
                    askAlcohol: "ÊÇ®ÈúÄË¶ÅÂê´ÈÖíÁ≤æÁöÑÈ•ÆÂìÅÂêóÔºü\nüëâ Êåâ‚ÄúÊòØ‚ÄùË°®Á§∫ÂêåÊÑèÔºåÊåâ‚ÄúÂê¶‚ÄùË°®Á§∫‰∏çÂêåÊÑè",
                    thinking: "ÊÄùËÄÉ‰∏≠",
                    recommendTitle: "ËøôÊòØÊàë‰∏∫ÊÇ®Êé®ËçêÁöÑËèúÂìÅÔºö",
                    confirmAdd: "ÊÇ®Ë¶ÅÂ∞ÜËøô‰∫õËèúÂìÅÂä†ÂÖ•Ë¥≠Áâ©ËΩ¶ÂêóÔºü\nüëâ Êåâ‚ÄúÊòØ‚ÄùË°®Á§∫ÂêåÊÑèÔºåÊåâ‚ÄúÂê¶‚ÄùË°®Á§∫‰∏çÂêåÊÑè",
                    addedToCart: "Â∑≤Â∞ÜÊâÄÊúâÊé®ËçêËèúÂìÅÂä†ÂÖ•Ë¥≠Áâ©ËΩ¶ÔºÅüéâ",
                    notAdded: "Ê≤°ÂÖ≥Á≥ªÔºÅÊÇ®ÂèØ‰ª•Ëá™Â∑±ÊµèËßàËèúÂçïÊàñËÆ©ÊàëÈáçÊñ∞Êé®Ëçê„ÄÇ",
                    yes: "ÊòØ",
                    no: "Âê¶",
                    total: "ÊÄªËÆ°",
                    inputPlaceholder: "ËæìÂÖ•Ê∂àÊÅØ...",
                    send: "ÂèëÈÄÅ",
                    error: "Êä±Ê≠âÔºåÂèëÁîüÈîôËØØ„ÄÇËØ∑ÈáçËØï„ÄÇ"
                }
            },
            ja: {
                tabs: { nuong: "ÁÑºËÇâ", lau: "Èçã", mon_phu: "„Çµ„Ç§„Éâ", nuoc: "„Éâ„É™„É≥„ÇØ", khai_vi: "ÂâçËèú", trang_mieng: "„Éá„Ç∂„Éº„Éà" },
                buttons: { add: "ËøΩÂä†", order: "Ê≥®Êñá„ÇíÁ¢∫Ë™ç„Åô„Çã", cart: "„Ç´„Éº„Éà", ordered: "Ê≥®ÊñáÊ∏à„Åø" },
                messages: {
                    orderSent: "Ê≥®Êñá„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„ÅüÔºÅ",
                    emptyCart: "„Ç´„Éº„Éà„ÅØÁ©∫„Åß„Åô!"
                },
                cart: { title: "„Ç´„Éº„Éà", total: "ÂêàË®à", qty: "Êï∞Èáè" },
                ordered: { title: "Ê≥®ÊñáÊ∏à„ÅøÊñôÁêÜ", total: "ÂêàË®à", qty: "Êï∞Èáè" },
                table: "„ÉÜ„Éº„Éñ„É´",
                confirm: {
                    clearAll: "„Ç´„Éº„ÉàÂÖ®‰Ωì„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?",
                    cancel: "„Ç≠„É£„É≥„Çª„É´",
                    ok: "Ê∂àÂéª"
                },
                chatbot: {
                    btnText: "AI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà",
                    title: "„ÅäÊñôÁêÜ„Åä„Åô„Åô„ÇÅ„Ç¢„Ç∑„Çπ„Çø„É≥„Éà",
                    greeting: "„Åì„Çì„Å´„Å°„ÅØÔºÅÁßÅ„ÅØYaki„ÅÆAI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Åß„Åô„ÄÇÊúÄÈÅ©„Å™ÊñôÁêÜÈÅ∏„Å≥„Çí„ÅäÊâã‰ºù„ÅÑ„Åó„Åæ„Åô„ÄÇ",
                    askGuests: "‰ΩïÂêçÊßò„Åß„ÅäÈ£ü‰∫ã„Åï„Çå„Åæ„Åô„ÅãÔºü",
                    askBudget: "„Åî‰∫àÁÆó„ÅØ„Åä„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü(VND)",
                    askAlcohol: "„Ç¢„É´„Ç≥„Éº„É´È£≤Êñô„ÅØ„ÅÑ„Åã„Åå„Åß„Åô„ÅãÔºü\nüëâ „ÅØ„ÅÑ„ÇíÊäº„Åô=ÂêåÊÑè„ÄÅ„ÅÑ„ÅÑ„Åà„ÇíÊäº„Åô=ÂêåÊÑè„Åó„Å™„ÅÑ",
                    thinking: "ËÄÉ„Åà‰∏≠",
                    recommendTitle: "„Åä„Åô„Åô„ÇÅÊñôÁêÜ„ÅØ„Åì„Å°„Çâ„Åß„ÅôÔºö",
                    confirmAdd: "„Åì„Çå„Çâ„ÅÆÊñôÁêÜ„Çí„Ç´„Éº„Éà„Å´ËøΩÂä†„Åó„Åæ„Åô„ÅãÔºü\nüëâ „ÅØ„ÅÑ„ÇíÊäº„Åô=ÂêåÊÑè„ÄÅ„ÅÑ„ÅÑ„Åà„ÇíÊäº„Åô=ÂêåÊÑè„Åó„Å™„ÅÑ",
                    addedToCart: "„Åä„Åô„Åô„ÇÅÊñôÁêÜ„Çí„Åô„Åπ„Å¶„Ç´„Éº„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅüéâ",
                    notAdded: "Â§ß‰∏àÂ§´„Åß„ÅôÔºÅ„É°„Éã„É•„Éº„Åã„ÇâÁõ¥Êé•„ÅäÈÅ∏„Å≥„ÅÑ„Åü„Å†„Åè„Åã„ÄÅ„Åæ„ÅüÁßÅ„Å´„ÅäÂ£∞„Åå„Åë„Åè„Å†„Åï„ÅÑ„ÄÇ",
                    yes: "„ÅØ„ÅÑ",
                    no: "„ÅÑ„ÅÑ„Åà",
                    total: "ÂêàË®à",
                    inputPlaceholder: "„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...",
                    send: "ÈÄÅ‰ø°",
                    error: "Áî≥„ÅóË®≥„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ"
                }
            },
            ko: {
                tabs: { nuong: "Íµ¨Ïù¥", lau: "Ï†ÑÍ≥®", mon_phu: "ÏÇ¨Ïù¥Îìú", nuoc: "ÏùåÎ£å", khai_vi: "Í∞ÑÏãù", trang_mieng: "ÎîîÏ†ÄÌä∏" },
                buttons: { add: "Ï∂îÍ∞Ä", order: "Ï£ºÎ¨∏ÌôïÏù∏", cart: "Ïû•Î∞îÍµ¨Îãà", ordered: "Ï£ºÎ¨∏ÏôÑÎ£å" },
                messages: {
                    orderSent: "Ï£ºÎ¨∏Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§!",
                    emptyCart: "Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§!"
                },
                cart: { title: "Ïû•Î∞îÍµ¨Îãà", total: "Ï¥ù", qty: "ÏàòÎüâ" },
                ordered: { title: "Ï£ºÎ¨∏ÏôÑÎ£å Î©îÎâ¥", total: "Ï¥ù", qty: "ÏàòÎüâ" },
                table: "ÌÖåÏù¥Î∏î",
                confirm: {
                    clearAll: "Ïû•Î∞îÍµ¨Îãà Ï†ÑÏ≤¥Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
                    cancel: "Ï∑®ÏÜå",
                    ok: "ÏÇ≠Ï†ú"
                },
                chatbot: {
                    btnText: "AI ÎèÑÏö∞ÎØ∏",
                    title: "ÏùåÏãù Ï∂îÏ≤ú ÎèÑÏö∞ÎØ∏",
                    greeting: "ÏïàÎÖïÌïòÏÑ∏Ïöî! Ï†ÄÎäî YakiÏùò AI ÎèÑÏö∞ÎØ∏ÏûÖÎãàÎã§. ÏôÑÎ≤ΩÌïú ÏöîÎ¶¨Î•º ÏÑ†ÌÉùÌïòÎäî Îç∞ ÎèÑÏõÄÏùÑ ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.",
                    askGuests: "Î™á Î∂ÑÏù¥ ÎìúÏã§ ÏòàÏ†ïÏù∏Í∞ÄÏöî?",
                    askBudget: "ÏòàÏÇ∞Ïù¥ Ïñ¥ÎñªÍ≤å ÎêòÏãúÎÇòÏöî? (VND)",
                    askAlcohol: "Ï£ºÎ•òÎ•º ÏõêÌïòÏãúÎÇòÏöî?\nüëâ ÏòàÎ•º ÎàÑÎ•¥Î©¥ ÎèôÏùòÌïòÍ≥†, ÏïÑÎãàÏöîÎ•º ÎàÑÎ•¥Î©¥ ÎèôÏùòÌïòÏßÄ ÏïäÏäµÎãàÎã§.",
                    thinking: "ÏÉùÍ∞Å Ï§ë",
                    recommendTitle: "Ï∂îÏ≤ú ÏöîÎ¶¨Îäî Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§:",
                    confirmAdd: "Ïù¥ ÏöîÎ¶¨Îì§ÏùÑ Ïû•Î∞îÍµ¨ÎãàÏóê Ï∂îÍ∞ÄÌïòÏãúÍ≤†Ïñ¥Ïöî?\nüëâ ÏòàÎ•º ÎàÑÎ•¥Î©¥ ÎèôÏùòÌïòÍ≥†, ÏïÑÎãàÏöîÎ•º ÎàÑÎ•¥Î©¥ ÎèôÏùòÌïòÏßÄ ÏïäÏäµÎãàÎã§.",
                    addedToCart: "Î™®Îì† Ï∂îÏ≤ú ÏöîÎ¶¨Í∞Ä Ïû•Î∞îÍµ¨ÎãàÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! üéâ",
                    notAdded: "Í¥úÏ∞ÆÏäµÎãàÎã§! Î©îÎâ¥ÏóêÏÑú ÏßÅÏ†ë ÏÑ†ÌÉùÌïòÏãúÍ±∞ÎÇò Îã§Ïãú Ï∂îÏ≤úÌï¥ ÎìúÎ¶¥Í≤åÏöî.",
                    yes: "Ïòà",
                    no: "ÏïÑÎãàÏò§",
                    total: "Ìï©Í≥Ñ",
                    inputPlaceholder: "Î©îÏãúÏßÄ ÏûÖÎ†•...",
                    send: "Î≥¥ÎÇ¥Í∏∞",
                    error: "Ï£ÑÏÜ°Ìï©ÎãàÎã§. Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥ Ï£ºÏÑ∏Ïöî."
                }
            }
        };

        /* ======================= PRODUCT DATA ======================= */
        // Products will be loaded from Firestore, with fallback to hardcoded data
        let products = {
            nuong: [], lau: [], mon_phu: [], nuoc: [], khai_vi: [], trang_mieng: []
        };

        // Fallback data (in case Firestore fails)
        const fallbackProducts = {
            nuong: [
                { id: 1, name: { vi: "Ba ch·ªâ b√≤ M·ªπ", en: "US beef belly", zh: "ÁæéÂúãÁâõËÖπËÇâ", ja: "Á±≥ÂõΩÁâõ„Éê„É©", ko: "ÎØ∏Íµ≠ ÏÜåÍ≥†Í∏∞ Î∞∞" }, price: 139000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/ba-chi-bo-my.jpg" },
                { id: 2, name: { vi: "D·∫ª s∆∞·ªùn b√≤", en: "Beef bibs", zh: "ÁâõËÇãÊéí", ja: "Áâõ„É™„Éñ", ko: "ÏÜåÍ∞àÎπÑ" }, price: 169000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/de-suon-bo-nuong.jpg" },
                { id: 3, name: { vi: "S∆∞·ªùn heo s·ªët m·∫≠t ong", en: "Honey pork ribs", zh: "ËúúÊ±ÅË±¨ËÇãÊéí", ja: "„Éè„Éã„Éº„Éù„Éº„ÇØ„É™„Éñ", ko: "ÌóàÎãà ÎèºÏßÄÍ∞àÎπÑ" }, price: 129000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/suon-nuong-mat-ong.jpg" },
                { id: 4, name: { vi: "G√† n∆∞·ªõng", en: "Grilled chicken", zh: "ÁÉ§Èõû", ja: "„Ç∞„É™„É´„ÉÅ„Ç≠„É≥", ko: "Íµ¨Ïö¥ Îã≠Í≥†Í∏∞" }, price: 89000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/ga-nuong.jpg" },
                { id: 13, name: { vi: "C√° h·ªìi n∆∞·ªõng", en: "Grilled salmon", zh: "ÁÉ§ÈÆ≠È≠ö", ja: "„Ç∞„É™„É´„Çµ„Éº„É¢„É≥", ko: "Íµ¨Ïö¥ Ïó∞Ïñ¥" }, price: 99000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/ca_hoi_nuong.png" },
                { id: 14, name: { vi: "M·ª±c n∆∞·ªõng", en: "Grilled squid", zh: "ÁÉ§È≠∑È≠ö", ja: "ÁÑº„Åç„Ç§„Ç´", ko: "Íµ¨Ïö¥ Ïò§ÏßïÏñ¥" }, price: 119000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/muc_nuong.jpg" },
                { id: 15, name: { vi: "T√¥m n∆∞·ªõng", en: "Grilled shrimp", zh: "ÁÉ§Ëù¶", ja: "ÁÑº„Åç„Ç®„Éì", ko: "Íµ¨Ïö¥ ÏÉàÏö∞" }, price: 109000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/tom_nuong.jpg" },
                { id: 16, name: { vi: "B√≤ b√≠t t·∫øt", en: "Beef steak", zh: "ÁâõÊéí", ja: "„Éì„Éº„Éï„Çπ„ÉÜ„Éº„Ç≠", ko: "ÏÜåÍ≥†Í∏∞ Ïä§ÌÖåÏù¥ÌÅ¨" }, price: 159000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/nuong/bo_beef_steak.jpg" }
            ],
            lau: [
                { id: 5, name: { vi: "L·∫©u kim chi", en: "Kimchi hotpot", zh: "Ê≥°ËèúÁÅ´ÈîÖ", ja: "„Ç≠„É†„ÉÅÈçã", ko: "ÍπÄÏπòÏ†ÑÍ≥®" }, price: 199000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/l·∫©u/Lau-kim-chi.png" },
                { id: 6, name: { vi: "L·∫©u bulgogi", en: "Bulgogi hotpot", zh: "ÁÉ§ËÇâÁÅ´ÈîÖ", ja: "„Éó„É´„Ç≥„ÇÆÈçã", ko: "Î∂àÍ≥†Í∏∞Ï†ÑÍ≥®" }, price: 249000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/l·∫©u/lau-bulgogi.webp" },
                { id: 17, name: { vi: "L·∫©u h·∫£i s·∫£n", en: "Seafood hotpot", zh: "Êµ∑ÈÆÆÁÅ´Èçã", ja: "Êµ∑ÈÆÆÈçã", ko: "Ìï¥ÏÇ∞Î¨º ÎÉÑÎπÑ" }, price: 209000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/l·∫©u/lau_hai_san.jpg" }
            ],
            mon_phu: [
                { id: 7, name: { vi: "Tokbokki ph√¥ mai", en: "Cheese tokbokki", zh: "ËäùÂ£´ÁÇíÂπ¥Á≥ï", ja: "„ÉÅ„Éº„Ç∫„Éà„ÉÉ„Éù„ÉÉ„Ç≠", ko: "ÏπòÏ¶à Îñ°Î≥∂Ïù¥" }, price: 35000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/m√≥n ph·ª•/tokbokki-pho-mai.jpg" },
                { id: 8, name: { vi: "C∆°m tr·ªôn H√†n Qu·ªëc", en: "Bibimbap", zh: "ÊãåÈ•≠", ja: "„Éì„Éì„É≥„Éê", ko: "ÎπÑÎπîÎ∞•" }, price: 49000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/m√≥n ph·ª•/com-tron-han-quoc.jpg" },
                { id: 9, name: { vi: "Khoai t√¢y chi√™n", en: "French fries", zh: "ËñØÊù°", ja: "„Éù„ÉÜ„Éà„Éï„É©„Ç§", ko: "Í∞êÏûêÌäÄÍπÄ" }, price: 39000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/m√≥n ph·ª•/khoai-tay-chien.webp" },
                { id: 18, name: { vi: "S√∫p b√†o ng∆∞", en: "Abalone soup", zh: "ÈÆëÈ≠öÊπØ", ja: "„Ç¢„ÉØ„Éì„ÅÆ„Çπ„Éº„Éó", ko: "Ï†ÑÎ≥µ ÏàòÌîÑ" }, price: 99000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/m√≥n ph·ª•/sup_bao_ngu.jpg" },
                { id: 19, name: { vi: "S√∫p h·∫£i s·∫£n", en: "Seafood soup", zh: "Êµ∑ÈÆÆÊπØ", ja: "„Ç∑„Éº„Éï„Éº„Éâ„Çπ„Éº„Éó", ko: "Ìï¥ÏÇ∞Î¨º ÏàòÌîÑ" }, price: 89000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/m√≥n ph·ª•/sup_hai_san.jpg" },
                { id: 20, name: { vi: "S√∫p miso", en: "Miso soup", zh: "Âë≥ÂôåÊπØ", ja: "Âë≥ÂôåÊ±Å", ko: "ÎêúÏû•Íµ≠" }, price: 39000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/m√≥n ph·ª•/sup_miso.jpg" },
                { id: 21, name: { vi: "T√¥m chi√™n x√π", en: "Fried shrimp", zh: "ÁÇ∏Ëù¶", ja: "„Ç®„Éì„Éï„É©„Ç§", ko: "ÏÉàÏö∞ÌäÄÍπÄ" }, price: 79000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/m√≥n ph·ª•/tom_chien_xu.jpg" }
            ],
            nuoc: [
                { id: 10, name: { vi: "Coca Cola", en: "Coca cola", zh: "ÂèØÂè£ÂèØ‰πê", ja: "„Ç≥„Ç´„Ç≥„Éº„É©", ko: "ÏΩîÏπ¥ÏΩúÎùº" }, price: 10000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/drink/coca-cola.jpg" },
                { id: 11, name: { vi: "Tr√† ƒë√†o", en: "Peach tea", zh: "Ê°ÉËå∂", ja: "„Éî„Éº„ÉÅ„ÉÜ„Ç£„Éº", ko: "Î≥µÏà≠ÏïÑÏ∞®" }, price: 15000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/drink/tra-dao.jpg" },
                { id: 12, name: { vi: "Bia", en: "Beer", zh: "Âï§ÈÖí", ja: "„Éì„Éº„É´", ko: "Îß•Ï£º" }, price: 29000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/drink/bia.png" },
                { id: 30, name: { vi: "R∆∞·ª£u vang", en: "Wine", zh: "Ëë°ËêÑÈÖí", ja: "„ÉØ„Ç§„É≥", ko: "ÏôÄÏù∏" }, price: 59000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/drink/ruou-vang.png" },
                { id: 31, name: { vi: "N∆∞·ªõc d∆∞a h·∫•u", en: "Watermelon juice", zh: "Ë•øÁìúÊ±Å", ja: "„Çπ„Ç§„Ç´„Ç∏„É•„Éº„Çπ", ko: "ÏàòÎ∞ï Ï£ºÏä§" }, price: 20000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/drink/nuoc_dua_hau.jpg" },
                { id: 32, name: { vi: "N∆∞·ªõc cam", en: "Orange juice", zh: "Êü≥Ê©ôÊ±Å", ja: "„Ç™„É¨„É≥„Ç∏„Ç∏„É•„Éº„Çπ", ko: "Ïò§Î†åÏßÄ Ï£ºÏä§" }, price: 15000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/drink/nuoc_cam.png" }
            ],
            khai_vi: [
                { id: 22, name: { vi: "G·ªèi ng√≥ sen", en: "Lotus root salad", zh: "ËìÆËóïÊ≤ôÊãâ", ja: "„É¨„É≥„Ç≥„É≥„Çµ„É©„ÉÄ", ko: "Ïó∞Í∑º ÏÉêÎü¨Îìú" }, price: 49000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/khai v·ªã/G·ªèi ng√≥ sen.jpg" },
                { id: 23, name: { vi: "Mi·∫øn tr·ªôn", en: "Mixed noodles", zh: "‰ªÄÈå¶Èù¢", ja: "Ê∑∑„ÅúÈ∫∫", ko: "ÌòºÌï©Î©¥" }, price: 30000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/khai v·ªã/Mi·∫øn tr·ªôn.jpg" },
                { id: 24, name: { vi: "Salad tr√°i c√¢y", en: "Fruit salad", zh: "Ê∞¥ÊûúÊ≤ôÊãâ", ja: "„Éï„É´„Éº„ÉÑ„Çµ„É©„ÉÄ", ko: "Í≥ºÏùº ÏÉêÎü¨Îìú" }, price: 45000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/khai v·ªã/Salad tr√°i c√¢y.jpg" }
            ],
            trang_mieng: [
                { id: 26, name: { vi: "Ch√® b∆∞·ªüi", en: "Grapefruit sweet soup", zh: "Ëë°ËêÑÊüöÁîúÊπØ", ja: "„Ç∞„É¨„Éº„Éó„Éï„É´„Éº„ÉÑ„ÅÆ„Çπ„Ç§„Éº„Éà„Çπ„Éº„Éó", ko: "ÏûêÎ™Ω Îã¨ÏΩ§Ìïú ÏàòÌîÑ" }, price: 10000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/tr√°ng mi·ªáng/Ch√® b∆∞·ªüi.jpg" },
                { id: 27, name: { vi: "Mouse chanh d√¢y", en: "Passion fruit mousse", zh: "ÁôæÈ¶ôÊûúÊÖïÊñØ", ja: "„Éë„ÉÉ„Ç∑„Éß„É≥„Éï„É´„Éº„ÉÑ„É†„Éº„Çπ", ko: "Ìå®ÏÖòÌîÑÎ£®Ìä∏ Î¨¥Ïä§" }, price: 25000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/tr√°ng mi·ªáng/Mousse chanh d√¢y.jpg" },
                { id: 28, name: { vi: "B√°nh kem", en: "Cake", zh: "ËõãÁ≥ï", ja: "„Ç±„Éº„Ç≠", ko: "ÏºÄÏù¥ÌÅ¨" }, price: 20000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/tr√°ng mi·ªáng/b√°nh_kem.jpg" },
                { id: 29, name: { vi: "Kem", en: "Ice cream", zh: "ÂÜ∞Ê∑áÊ∑ã", ja: "„Ç¢„Ç§„Çπ„ÇØ„É™„Éº„É†", ko: "ÏïÑÏù¥Ïä§ÌÅ¨Î¶º" }, price: 15000, img: "https://raw.githubusercontent.com/huyhuynh03/imagine-order-system-app/main/food/tr√°ng mi·ªáng/kem.jpg" }
            ]
        };

        /* ======================= DYNAMIC CATEGORIES ======================= */
        // Categories list (loaded from Firestore)
        let categoriesList = [];

        // Default categories fallback
        const defaultCategories = [
            { key: 'nuong', name: { vi: 'M√≥n n∆∞·ªõng', en: 'Grilled', zh: 'ÁÉßÁÉ§', ja: 'ÁÑº„ÅçÁâ©', ko: 'Íµ¨Ïù¥' } },
            { key: 'lau', name: { vi: 'L·∫©u', en: 'Hotpot', zh: 'ÁÅ´ÈîÖ', ja: 'Èçã', ko: 'Ï†ÑÍ≥®' } },
            { key: 'mon_phu', name: { vi: 'M√≥n ph·ª•', en: 'Side Dishes', zh: 'ÈÖçËèú', ja: '„Çµ„Ç§„Éâ„É°„Éã„É•„Éº', ko: 'Î∞òÏ∞¨' } },
            { key: 'nuoc', name: { vi: 'ƒê·ªì u·ªëng', en: 'Drinks', zh: 'È•ÆÊñô', ja: '„Éâ„É™„É≥„ÇØ', ko: 'ÏùåÎ£å' } },
            { key: 'khai_vi', name: { vi: 'Khai v·ªã', en: 'Appetizer', zh: 'ÂºÄËÉÉËèú', ja: 'ÂâçËèú', ko: 'ÏóêÌîºÌÉÄÏù¥Ï†Ä' } },
            { key: 'trang_mieng', name: { vi: 'Tr√°ng mi·ªáng', en: 'Dessert', zh: 'ÁîúÁÇπ', ja: '„Éá„Ç∂„Éº„Éà', ko: 'ÎîîÏ†ÄÌä∏' } }
        ];

        // Load categories from Firestore
        async function loadCategories() {
            try {
                const doc = await db.collection('settings').doc('categories').get();
                if (doc.exists && doc.data().list) {
                    categoriesList = doc.data().list;
                } else {
                    categoriesList = defaultCategories;
                }
            } catch (error) {
                console.log('Using default categories');
                categoriesList = defaultCategories;
            }
        }

        // Render category tabs dynamically
        function renderTabs() {
            const container = document.getElementById('tabsContainer');
            container.innerHTML = categoriesList.map((cat, index) => {
                const catName = cat.name?.[currentLang] || cat.name?.vi || cat.key;
                const activeClass = index === 0 ? 'active' : '';
                return `<div class="tab ${activeClass}" onclick="changeTab('${cat.key}', event)">${catName}</div>`;
            }).join('');

            // Set first category as default tab
            if (categoriesList.length > 0) {
                currentTab = categoriesList[0].key;
            }
        }

        // Load products from Firestore
        async function loadProductsFromFirestore() {
            try {
                console.log('üì¶ Loading products from Firestore...');
                const snapshot = await db.collection('products')
                    .where('available', '==', true)
                    .get();

                if (snapshot.empty) {
                    console.log('‚ö†Ô∏è No products in Firestore, using fallback data');
                    products = fallbackProducts;
                    return;
                }

                // Reset products object dynamically based on categories
                products = {};
                categoriesList.forEach(cat => {
                    products[cat.key] = [];
                });

                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Create category array if it doesn't exist (for new categories)
                    if (!products[data.category]) {
                        products[data.category] = [];
                    }
                    products[data.category].push({
                        id: doc.id,
                        name: data.name,
                        price: data.price,
                        img: data.img
                    });
                });

                console.log(`‚úÖ Loaded ${snapshot.size} products from Firestore`);
            } catch (error) {
                console.error('‚ùå Failed to load products from Firestore:', error);
                console.log('‚ö†Ô∏è Using fallback data');
                products = fallbackProducts;
            }
        }

        /* ======================= STATE ======================= */
        let cart = {};
        let currentTab = "nuong";
        // Load saved language from localStorage, default to 'vi'
        let currentLang = localStorage.getItem('yaki_language') || "vi";
        let orderedItems = {}; // l∆∞u c√°c m√≥n ƒë√£ ƒë·∫∑t (icon chu√¥ng)
        let currentTableId = 1; // l∆∞u table ID t·ª´ URL

        // Set language dropdown to match saved language on page load
        function initLanguageDropdown() {
            const langSelect = document.getElementById('langSelect');
            const langDisplayMap = {
                'vi': 'Ti·∫øng Vi·ªát',
                'en': 'English',
                'zh': '‰∏≠Êñá',
                'ja': 'Êó•Êú¨Ë™û',
                'ko': 'ÌïúÍµ≠Ïñ¥'
            };
            // Set dropdown value
            langSelect.value = langDisplayMap[currentLang] || 'Ti·∫øng Vi·ªát';

            // Update UI text to match saved language
            document.getElementById("tableDisplay").innerText = `${translations[currentLang].table} ${currentTableId}`;
            document.getElementById("cartBtnText").innerText = translations[currentLang].buttons.cart;
            document.getElementById("cartTitle").innerText = translations[currentLang].cart.title;
            document.getElementById("totalLabel").innerText = translations[currentLang].cart.total;
            document.getElementById("orderBtn").innerText = translations[currentLang].buttons.order;
            document.getElementById("orderedText").innerText = translations[currentLang].buttons.ordered;
            document.getElementById("orderedTitle").innerText = translations[currentLang].ordered.title;
            document.getElementById("orderedTotalLabel").innerText = translations[currentLang].ordered.total;
        }


        /* ======================= RENDER MENU ======================= */
        function renderMenu() {
            const list = document.getElementById("menuList");
            list.innerHTML = "";

            products[currentTab].forEach(item => {
                if (!cart[item.id]) cart[item.id] = { ...item, qty: 0 };

                list.innerHTML += `
            <div class="card
            ${cart[item.id].qty > 0 ? "selected" : ""}
            ${orderedItems[item.id] ? "ordered-flag" : ""}
            ">

             ${cart[item.id].qty > 0 ? '<div class="tick-mark">‚úì</div>' : ""}

            <img src="${item.img}">
            <div class="card-body">
                <div style="font-size:18px;font-weight:bold;">${item.name[currentLang]}</div>
                <div class="price">${item.price.toLocaleString()} ƒë</div>

                <div class="qty-row">
                    <div class="qty-btn" onclick="changeQty('${item.id}', -1)">‚àí</div>
                    <input type="number"
                     id="qtyInput_${item.id}"
                     class="qty-input"
                     value="${cart[item.id].tempQty ?? cart[item.id].qty}"
                     min="0"
                     oninput="updateTempQty('${item.id}', this.value)">

                    <div class="qty-btn" onclick="changeQty('${item.id}', 1)">+</div>
                    <div class="add-cart-btn" onclick="addToCart('${item.id}')">
                        ${translations[currentLang].buttons.add}
                    </div>
                </div>
            </div>
        </div>`;
            });
        }
        /* ======================= TAB ======================= */
        function changeTab(tab, event) {
            currentTab = tab;
            document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
            event.target.classList.add("active");
            renderMenu();
        }

        /* ======================= QTY ======================= */
        function changeQty(id, val) {
            if (!cart[id].tempQty) cart[id].tempQty = 0;

            cart[id].tempQty = Math.max(0, Number(cart[id].tempQty) + val);

            const num = cart[id].tempQty;
            document.getElementById(`qtyInput_${id}`).value = num;

            // üî• N·∫øu m√≥n ƒë√£ trong gi·ªè ‚Üí c·∫≠p nh·∫≠t gi·ªè ngay
            if (cart[id].qty > 0) {

                if (num === 0) {
                    cart[id].qty = 0;
                    updateCart();
                    renderMenu();
                    return;
                }

                cart[id].qty = num;
                updateCart();
                renderCartItems();
            }

            renderMenu();
        }


        function updateTempQty(id, value) {
            // Cho ph√©p xo√° h·∫øt ƒë·ªÉ g√µ l·∫°i m√† kh√¥ng b·ªã reset
            if (value === "") {
                cart[id].tempQty = 0;
                return;
            }

            let num = Number(value);
            if (isNaN(num)) return;

            num = Math.max(0, num);
            cart[id].tempQty = num;

            // N·∫øu m√≥n n√†y ƒë√£ n·∫±m trong gi·ªè th√¨ c·∫≠p nh·∫≠t lu√¥n SL th·∫≠t + t·ªïng ti·ªÅn
            if (cart[id].qty > 0) {
                if (num === 0) {
                    cart[id].qty = 0;
                    updateCart();   // ch·ªâ c·∫≠p nh·∫≠t gi·ªè, KH√îNG render l·∫°i menu
                    renderMenu();   // üî• th√™m d√≤ng n√†y ƒë·ªÉ g·ª° tick ngay l·∫≠p t·ª©c
                    return;
                }

                cart[id].qty = num;
                updateCart();       // c·∫≠p nh·∫≠t t·ªïng + danh s√°ch trong gi·ªè
            }
        }




        /* ======================= ADD TO CART ======================= */
        function addToCart(id) {
            const temp = Number(cart[id].tempQty || 0);

            if (temp > 0) {
                cart[id].qty = temp;  // C·∫¨P NH·∫¨T GI·ªé
                updateCart();
                renderMenu();

            }

            // Animation rung
            const el = document.getElementById("cartCount");
            el.style.animation = "shake 0.4s";
            setTimeout(() => el.style.animation = "", 400);
        }

        /* ======================= UPDATE CART ======================= */
        function updateCart() {
            let total = 0, count = 0;

            for (let id in cart) {
                if (cart[id].qty > 0) {
                    total += cart[id].qty * cart[id].price;
                    count += cart[id].qty;
                }
            }

            // total ordered
            let orderedTotal = 0;
            for (let id in orderedItems) {
                orderedTotal += orderedItems[id].qty * orderedItems[id].price;
            }

            // total final
            document.getElementById("totalPrice").innerText =
                (total + orderedTotal).toLocaleString();


            document.getElementById("totalPrice").innerText = total.toLocaleString();
            document.getElementById("cartCount").innerText = count;
            renderCartItems();

            // Save cart to localStorage
            saveCartToStorage();
        }

        /* ======================= CART PERSISTENCE ======================= */
        // Save cart to localStorage (per table)
        function saveCartToStorage() {
            const cartData = {};
            for (let id in cart) {
                if (cart[id].qty > 0) {
                    cartData[id] = {
                        id: cart[id].id,
                        name: cart[id].name,
                        price: cart[id].price,
                        img: cart[id].img,
                        qty: cart[id].qty,
                        tempQty: cart[id].tempQty
                    };
                }
            }
            localStorage.setItem(`yaki_cart_table_${currentTableId}`, JSON.stringify(cartData));
        }

        // Load cart from localStorage
        function loadCartFromStorage() {
            const savedCart = localStorage.getItem(`yaki_cart_table_${currentTableId}`);
            if (savedCart) {
                try {
                    const cartData = JSON.parse(savedCart);
                    for (let id in cartData) {
                        cart[id] = cartData[id];
                    }
                    console.log('‚úÖ Cart restored from localStorage');
                } catch (e) {
                    console.log('‚ö†Ô∏è Could not parse saved cart');
                }
            }
        }

        // Clear cart from localStorage (called after successful order)
        function clearCartStorage() {
            localStorage.removeItem(`yaki_cart_table_${currentTableId}`);
        }

        /* ======================= CART ITEMS ======================= */
        function renderCartItems() {
            const box = document.getElementById("cartItems");
            box.innerHTML = "";

            for (let id in cart) {
                if (cart[id].qty > 0) {
                    box.innerHTML += `
<div class="cart-item">
    <b>${cart[id].name[currentLang]}</b><br>

    <div class="cart-qty-row">
        ${translations[currentLang].cart.qty}:
        <span class="cart-qty-btn" onclick="changeCartQtyBtn('${id}', -1)">‚àí</span>
        <input class="cartQtyInput"
            type="number"
            value="${cart[id].qty}"
            min="0"
            data-id="${id}"
            oninput="changeCartQty(this)">
        <span class="cart-qty-btn" onclick="changeCartQtyBtn('${id}', 1)">+</span>
        √ó ${cart[id].price.toLocaleString()} ƒë
        <span class="cart-item-delete" onclick="deleteItem('${id}')">üóëÔ∏è</span>
    </div>
</div>`;


                }
            }
        }

        /* ======================= CART PANEL ======================= */



        function toggleCart() {
            document.getElementById("cartPanel").classList.toggle("show");
        }

        function toggleOrdered() {
            document.getElementById("orderedPanel").classList.toggle("show");
        }


        /* ======================= ORDER ======================= */
        function placeOrder() {
            let hasItems = false;
            let itemsToOrder = [];

            for (let id in cart) {
                if (cart[id].qty > 0) {
                    hasItems = true;
                    itemsToOrder.push({
                        id: id,
                        name: cart[id].name, // L∆∞u c·∫£ object t√™n ƒëa ng√¥n ng·ªØ
                        price: cart[id].price,
                        qty: cart[id].qty
                    });
                }
            }

            if (!hasItems) {
                showAlert(translations[currentLang].messages.emptyCart);
                return;
            }

            // L·∫•y b√†n t·ª´ URL parameter
            const tableIndex = currentTableId;
            const tableId = `table_${tableIndex}`;

            // G·ª≠i l√™n Firebase
            const tableRef = db.collection("tables").doc(tableId);

            // G·ª≠i l√™n Firebase v√† ch·ªù k·∫øt qu·∫£
            tableRef.get().then((doc) => {
                let currentOrders = [];
                if (doc.exists) {
                    currentOrders = doc.data().orders || [];
                }

                // N·ªëi th√™m m√≥n m·ªõi
                const newOrders = currentOrders.concat(itemsToOrder);

                // Update l·∫°i
                return tableRef.set({
                    name: `B√†n ${tableIndex}`,
                    orders: newOrders,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            }).then(() => {
                // Sau khi g·ª≠i th√†nh c√¥ng, clear gi·ªè h√†ng
                // orderedItems s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t qua Firebase listener
                for (let id in cart) {
                    if (cart[id].qty > 0) {
                        cart[id].qty = 0;
                        cart[id].tempQty = 0;
                    }
                }

                // Clear cart from localStorage after successful order
                clearCartStorage();

                updateCart();
                renderMenu();
                showAlert(translations[currentLang].messages.orderSent);
            }).catch((error) => {
                console.error("Error writing document: ", error);
                showAlert("L·ªói k·∫øt n·ªëi Firebase!");
            });
        }



        /* ======================= LANGUAGE SWITCH ======================= */
        document.getElementById("langSelect").addEventListener("change", function () {

            document.getElementById("confirmCancelBtn").innerText = translations[currentLang].confirm.cancel;
            document.getElementById("confirmOkBtn").innerText = translations[currentLang].confirm.ok;


            currentLang = {
                "Ti·∫øng Vi·ªát": "vi", "English": "en", "‰∏≠Êñá": "zh", "Êó•Êú¨Ë™û": "ja", "ÌïúÍµ≠Ïñ¥": "ko"
            }[this.value];

            // Update tab text
            document.querySelectorAll(".tab").forEach(tab => {
                const key = tab.getAttribute("onclick").match(/'(\w+)'/)[1];
                tab.innerText = translations[currentLang].tabs[key];
            });

            // Buttons
            document.getElementById("orderBtn").innerText = translations[currentLang].buttons.order;
            document.getElementById("cartBtnText").innerText = translations[currentLang].buttons.cart;
            document.getElementById("orderedText").innerText = translations[currentLang].buttons.ordered;

            // Cart text
            document.getElementById("cartTitle").innerText = translations[currentLang].cart.title;
            document.getElementById("totalLabel").innerText = translations[currentLang].cart.total;

            // Ordered panel text
            document.getElementById("orderedTitle").innerText = translations[currentLang].ordered.title;
            document.getElementById("orderedTotalLabel").innerText = translations[currentLang].ordered.total;

            // Update table display text with current language
            const tableDisplay = document.getElementById("tableDisplay");
            tableDisplay.innerText = `${translations[currentLang].table} ${currentTableId}`;

            // ‚¨ÖÔ∏è FIX: Re-render menu + cart + ordered items theo ng√¥n ng·ªØ m·ªõi
            renderMenu();
            updateCart();
            renderOrderedItems();

            // Update chatbot UI language
            updateChatbotLanguage();
        });

        /* ======================= URL PARAMETER HANDLING ======================= */
        // Max table count (will be loaded from Firestore)
        let maxTableCount = 10; // Default fallback

        // Load max table count from Firestore
        async function loadMaxTableCount() {
            try {
                const doc = await db.collection('settings').doc('tables').get();
                if (doc.exists && doc.data().count) {
                    maxTableCount = doc.data().count;
                }
            } catch (error) {
                console.log('Using default table count:', maxTableCount);
            }
        }

        // L·∫•y table ID t·ª´ URL parameter (v√≠ d·ª•: ?table=3)
        function getTableIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const tableParam = urlParams.get('table');

            if (tableParam) {
                const tableNum = parseInt(tableParam);
                // Validate table number (1 to maxTableCount)
                if (tableNum >= 1 && tableNum <= maxTableCount) {
                    return tableNum;
                }
            }

            // Default to table 1 if no valid parameter
            return 1;
        }

        /* INIT */
        // Initialize app with async data loading
        (async function initApp() {
            // Load table count first to validate URL parameter
            await loadMaxTableCount();

            // L·∫•y table ID t·ª´ URL v√† c·∫≠p nh·∫≠t hi·ªÉn th·ªã
            currentTableId = getTableIdFromUrl();
            document.getElementById("tableDisplay").innerText = `${translations[currentLang].table} ${currentTableId}`;

            // Load categories from Firestore
            await loadCategories();

            // Render category tabs
            renderTabs();

            // Load products from Firestore (with fallback to hardcoded)
            await loadProductsFromFirestore();

            // Start listening to Firebase for real-time updates
            listenToTableOrders();

            // Load saved cart from localStorage
            loadCartFromStorage();

            // Render menu after products are loaded
            renderMenu();

            // Update cart display with restored items
            updateCart();
        })();

        // Using Cloudflare Worker proxy to secure API key
        const GEMINI_API_URL = 'https://gemini-proxy.yaki-api.workers.dev';

        // Chatbot state
        let aiChatState = {
            step: 0, // 0: greeting, 1: ask guests, 2: ask budget, 3: ask alcohol, 4: show recommendations, 5: confirm add
            guests: 0,
            budget: 0,
            wantsAlcohol: false,
            recommendations: [],
            isOpen: false
        };

        // Toggle chatbot panel
        function toggleAiChat() {
            const panel = document.getElementById("aiChatPanel");
            aiChatState.isOpen = !aiChatState.isOpen;
            panel.classList.toggle("show");

            // If opening for first time or reset, start conversation
            if (aiChatState.isOpen && aiChatState.step === 0) {
                startAiConversation();
            }
        }

        // Start/restart conversation
        function startAiConversation() {
            const messagesDiv = document.getElementById("aiChatMessages");
            messagesDiv.innerHTML = "";
            aiChatState = {
                step: 1,
                guests: 0,
                budget: 0,
                wantsAlcohol: false,
                recommendations: [],
                isOpen: true
            };

            // Show greeting then ask guests
            addBotMessage(translations[currentLang].chatbot.greeting);
            setTimeout(() => {
                addBotMessage(translations[currentLang].chatbot.askGuests);
            }, 500);

            showInputArea();
            hideQuickResponses();
        }

        // Add bot message to chat
        function addBotMessage(text) {
            const messagesDiv = document.getElementById("aiChatMessages");
            const msgDiv = document.createElement("div");
            msgDiv.className = "ai-message bot";
            msgDiv.innerHTML = text.replace(/\n/g, "<br>");
            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Add user message to chat
        function addUserMessage(text) {
            const messagesDiv = document.getElementById("aiChatMessages");
            const msgDiv = document.createElement("div");
            msgDiv.className = "ai-message user";
            msgDiv.textContent = text;
            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Add thinking indicator
        function addThinkingMessage() {
            const messagesDiv = document.getElementById("aiChatMessages");
            const msgDiv = document.createElement("div");
            msgDiv.className = "ai-message bot thinking";
            msgDiv.id = "thinkingMsg";
            msgDiv.textContent = translations[currentLang].chatbot.thinking;
            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Remove thinking indicator
        function removeThinkingMessage() {
            const thinkingMsg = document.getElementById("thinkingMsg");
            if (thinkingMsg) thinkingMsg.remove();
        }

        // Show/hide UI elements
        function showInputArea() {
            document.getElementById("aiChatInputArea").style.display = "flex";
        }

        function hideInputArea() {
            document.getElementById("aiChatInputArea").style.display = "none";
        }

        function showQuickResponses() {
            document.getElementById("aiQuickResponses").style.display = "flex";
        }

        function hideQuickResponses() {
            document.getElementById("aiQuickResponses").style.display = "none";
        }

        // Send user message from input
        function sendAiMessage() {
            const input = document.getElementById("aiChatInput");
            const text = input.value.trim();
            if (!text) return;

            addUserMessage(text);
            input.value = "";

            processUserInput(text);
        }

        // Handle quick response buttons (0 or 1)
        function handleQuickResponse(value) {
            addUserMessage(value === 1 ? translations[currentLang].chatbot.yes : translations[currentLang].chatbot.no);
            hideQuickResponses();

            if (aiChatState.step === 3) {
                // Alcohol preference answered
                aiChatState.wantsAlcohol = value === 1;
                aiChatState.step = 4;
                getRecommendations();
            } else if (aiChatState.step === 5) {
                // Confirm add to cart
                if (value === 1) {
                    addRecommendationsToCart();
                    addBotMessage(translations[currentLang].chatbot.addedToCart);
                } else {
                    addBotMessage(translations[currentLang].chatbot.notAdded);
                }
                // Reset for new conversation
                setTimeout(() => {
                    aiChatState.step = 0;
                }, 1000);
            }
        }

        // Process user text input based on current step
        function processUserInput(text) {
            switch (aiChatState.step) {
                case 1: // Waiting for number of guests
                    const guests = parseInt(text);
                    if (isNaN(guests) || guests < 1) {
                        addBotMessage(translations[currentLang].chatbot.askGuests);
                        return;
                    }
                    aiChatState.guests = guests;
                    aiChatState.step = 2;
                    addBotMessage(translations[currentLang].chatbot.askBudget);
                    break;

                case 2: // Waiting for budget
                    const budget = parseInt(text.replace(/[,.\s]/g, ""));
                    if (isNaN(budget) || budget < 1000) {
                        addBotMessage(translations[currentLang].chatbot.askBudget);
                        return;
                    }
                    aiChatState.budget = budget;
                    aiChatState.step = 3;
                    addBotMessage(translations[currentLang].chatbot.askAlcohol);
                    hideInputArea();
                    showQuickResponses();
                    break;
            }
        }

        // Build menu context for AI
        function buildMenuContext() {
            let menuText = "MENU (prices in VND):\n\n";

            for (const category in products) {
                const categoryName = translations[currentLang].tabs[category] || category;
                menuText += `=== ${categoryName} ===\n`;

                products[category].forEach(item => {
                    const name = item.name[currentLang] || item.name.vi;
                    const isAlcohol = item.id === 12 || item.id === 30; // Beer and Wine
                    menuText += `- ID:${item.id}, ${name}, ${item.price.toLocaleString()}ƒë${isAlcohol ? " (alcohol)" : ""}\n`;
                });
                menuText += "\n";
            }

            return menuText;
        }

        // Get recommendations from Gemini API
        async function getRecommendations() {
            addThinkingMessage();
            hideInputArea();

            const menuContext = buildMenuContext();
            const langName = {
                vi: "Vietnamese",
                en: "English",
                zh: "Chinese",
                ja: "Japanese",
                ko: "Korean"
            }[currentLang];

            const prompt = `You are a restaurant assistant at Yaki, a Korean BBQ restaurant.

${menuContext}

Customer information:
- Number of guests: ${aiChatState.guests}
- Budget: ${aiChatState.budget.toLocaleString()} VND
- Wants alcoholic beverages: ${aiChatState.wantsAlcohol ? "Yes" : "No"}

Recommend dishes for this customer. Stay within budget. Include variety: main dishes, sides, drinks.
${aiChatState.wantsAlcohol ? "Include beer/wine." : "Only non-alcoholic drinks."}

IMPORTANT: Respond in ${langName} language. DO NOT explain or add any extra text.

Format EXACTLY like this:
- [Item Name] x[quantity] - [price]ƒë [ID:X]
${translations[currentLang].chatbot.total}: [total price]ƒë`;

            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        prompt: prompt
                    })
                });

                const data = await response.json();
                removeThinkingMessage();

                if (data.success && data.response) {
                    const aiResponse = data.response;
                    parseAndShowRecommendations(aiResponse);
                } else {
                    console.error("Worker error:", data.error);
                    addBotMessage(translations[currentLang].chatbot.error);
                    showInputArea();
                    aiChatState.step = 1;
                }
            } catch (error) {
                console.error("Gemini API error:", error);
                removeThinkingMessage();
                addBotMessage(translations[currentLang].chatbot.error);
                showInputArea();
                aiChatState.step = 1;
            }
        }

        // Parse AI response and show recommendations
        function parseAndShowRecommendations(response) {
            // Remove [ID:xxx] from display (handles both numeric and alphanumeric IDs)
            const displayResponse = response.replace(/\s*\[ID:[^\]]+\]/gi, '');
            // Show the AI's response without IDs
            addBotMessage(displayResponse.replace(/\n/g, "<br>"));

            // Try to extract item IDs from the response (handles alphanumeric Firestore IDs)
            aiChatState.recommendations = [];
            const idPattern = /x(\d+)[^\[]*\[ID:([^\]]+)\]/gi;
            let match;

            while ((match = idPattern.exec(response)) !== null) {
                const qty = parseInt(match[1]);
                const itemId = match[2]; // Keep as string for Firestore IDs

                // Find the product
                for (const category in products) {
                    const product = products[category].find(p => String(p.id) === String(itemId));
                    if (product) {
                        aiChatState.recommendations.push({
                            ...product,
                            qty: qty
                        });
                        break;
                    }
                }
            }

            // If no IDs found, try to match by name
            if (aiChatState.recommendations.length === 0) {
                for (const category in products) {
                    products[category].forEach(product => {
                        const nameVi = product.name.vi.toLowerCase();
                        const nameEn = product.name.en.toLowerCase();
                        const nameCurrent = product.name[currentLang]?.toLowerCase() || "";

                        if (response.toLowerCase().includes(nameVi) ||
                            response.toLowerCase().includes(nameEn) ||
                            response.toLowerCase().includes(nameCurrent)) {

                            // Try to find quantity
                            const qtyMatch = response.match(new RegExp(`${product.name[currentLang]}[^x]*x\\s*(\\d+)`, "i")) ||
                                response.match(new RegExp(`${product.name.vi}[^x]*x\\s*(\\d+)`, "i"));
                            const qty = qtyMatch ? parseInt(qtyMatch[1]) : 1;

                            if (!aiChatState.recommendations.find(r => r.id === product.id)) {
                                aiChatState.recommendations.push({
                                    ...product,
                                    qty: qty
                                });
                            }
                        }
                    });
                }
            }

            // Ask for confirmation
            aiChatState.step = 5;
            setTimeout(() => {
                addBotMessage(translations[currentLang].chatbot.confirmAdd);
                showQuickResponses();
            }, 500);
        }

        // Add recommendations to cart
        function addRecommendationsToCart() {
            aiChatState.recommendations.forEach(item => {
                if (!cart[item.id]) {
                    cart[item.id] = { ...item, qty: 0, tempQty: 0 };
                }
                cart[item.id].qty += item.qty;
                cart[item.id].tempQty = cart[item.id].qty;
            });

            updateCart();
            renderMenu();

            // Animation on cart button
            const el = document.getElementById("cartCount");
            el.style.animation = "shake 0.4s";
            setTimeout(() => el.style.animation = "", 400);
        }

        // Update chatbot UI when language changes
        function updateChatbotLanguage() {
            document.getElementById("aiChatBtnText").innerText = translations[currentLang].chatbot.btnText;
            document.getElementById("aiChatTitle").innerText = translations[currentLang].chatbot.title;
            document.getElementById("aiYesText").innerText = translations[currentLang].chatbot.yes;
            document.getElementById("aiNoText").innerText = translations[currentLang].chatbot.no;
            document.getElementById("aiChatInput").placeholder = translations[currentLang].chatbot.inputPlaceholder;
            document.getElementById("aiSendBtn").innerText = translations[currentLang].chatbot.send;
        }

        // Language change handler - update tabs and UI when language changes
        document.getElementById('langSelect').addEventListener('change', function () {
            const langMap = {
                "Ti·∫øng Vi·ªát": "vi", "English": "en", "‰∏≠Êñá": "zh", "Êó•Êú¨Ë™û": "ja", "ÌïúÍµ≠Ïñ¥": "ko"
            };
            currentLang = langMap[this.value] || 'vi';

            // Save language preference to localStorage
            localStorage.setItem('yaki_language', currentLang);

            // Re-render category tabs with new language
            renderTabs();

            // Re-render menu to update item names
            renderMenu();

            // Update chatbot language
            updateChatbotLanguage();

            // Update other UI text
            document.getElementById("tableDisplay").innerText = `${translations[currentLang].table} ${currentTableId}`;
            document.getElementById("cartBtnText").innerText = translations[currentLang].buttons.cart;
            document.getElementById("cartTitle").innerText = translations[currentLang].cart.title;
            document.getElementById("totalLabel").innerText = translations[currentLang].cart.total;
            document.getElementById("orderBtn").innerText = translations[currentLang].buttons.order;
            document.getElementById("orderedText").innerText = translations[currentLang].buttons.ordered;
            document.getElementById("orderedTitle").innerText = translations[currentLang].ordered.title;
            document.getElementById("orderedTotalLabel").innerText = translations[currentLang].ordered.total;

            // Re-render cart and ordered items with new language
            renderCartItems();
            renderOrderedItems();
        });

        // Initialize chatbot language and restore saved language
        updateChatbotLanguage();
        initLanguageDropdown();
    </script>


    <div id="customAlertOverlay">
        <div id="customAlertBox">
            <div id="alertMessage">Th√¥ng b√°o</div>
            <div id="alertOkBtn" onclick="closeAlert()">OK</div>
        </div>
    </div>


    <div id="customConfirmOverlay">
        <div id="customConfirmBox">
            <div id="confirmMessage">B·∫°n c√≥ ch·∫Øc?</div>

            <div class="confirm-buttons">
                <div id="confirmCancelBtn" class="confirm-btn" onclick="closeConfirm(false)">H·ªßy</div>
                <div id="confirmOkBtn" class="confirm-btn" onclick="closeConfirm(true)">X√≥a</div>
            </div>
        </div>
    </div>


    <!-- Service Worker Registration for Image Caching -->
    <script>
        // ƒêƒÉng k√Ω Service Worker ƒë·ªÉ cache ·∫£nh
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registered - Images will be cached!');

                        // Ki·ªÉm tra s·ªë l∆∞·ª£ng ·∫£nh ƒë√£ cache (optional)
                        if (registration.active) {
                            registration.active.postMessage({ action: 'getCacheStats' });
                        }

                        // Preload t·∫•t c·∫£ ·∫£nh ngay khi SW s·∫µn s√†ng
                        preloadAllImages();
                    })
                    .catch((error) => {
                        console.log('‚ö†Ô∏è Service Worker registration failed:', error);
                        // V·∫´n preload ·∫£nh d√π SW fail
                        preloadAllImages();
                    });

                // L·∫Øng nghe message t·ª´ Service Worker
                navigator.serviceWorker.addEventListener('message', (event) => {
                    if (event.data.action === 'cacheStats') {
                        console.log(`üì¶ Cached images: ${event.data.count}`);
                    }
                    if (event.data.action === 'preloadComplete') {
                        console.log(`üéâ All images preloaded and cached!`);
                    }
                });
            });
        } else {
            // N·∫øu kh√¥ng h·ªó tr·ª£ SW, v·∫´n preload ·∫£nh ƒë·ªÉ browser t·ª± cache
            window.addEventListener('load', preloadAllImages);
        }

        /**
         * Preload T·∫§T C·∫¢ ·∫£nh s·∫£n ph·∫©m ngay khi trang m·ªü
         * ·∫¢nh s·∫Ω ƒë∆∞·ª£c t·∫£i v√† cache ngay l·∫≠p t·ª©c
         */
        function preloadAllImages() {
            // Thu th·∫≠p t·∫•t c·∫£ URL ·∫£nh t·ª´ products object
            const allImageUrls = [];

            for (const category in products) {
                products[category].forEach(item => {
                    if (item.img) {
                        allImageUrls.push(item.img);
                    }
                });
            }

            console.log(`üöÄ Preloading ${allImageUrls.length} images...`);

            let loadedCount = 0;
            let errorCount = 0;

            // T·∫°o Image objects ƒë·ªÉ preload
            allImageUrls.forEach((url, index) => {
                const img = new Image();

                img.onload = () => {
                    loadedCount++;
                    // Log ti·∫øn tr√¨nh m·ªói 5 ·∫£nh
                    if (loadedCount % 5 === 0 || loadedCount === allImageUrls.length) {
                        console.log(`üì∑ Preloaded: ${loadedCount}/${allImageUrls.length} images`);
                    }

                    // Khi t·∫•t c·∫£ ·∫£nh ƒë√£ load xong
                    if (loadedCount + errorCount === allImageUrls.length) {
                        console.log(`‚úÖ Preload complete! ${loadedCount} loaded, ${errorCount} failed`);
                    }
                };

                img.onerror = () => {
                    errorCount++;
                    console.warn(`‚ö†Ô∏è Failed to preload: ${url.substring(0, 50)}...`);

                    if (loadedCount + errorCount === allImageUrls.length) {
                        console.log(`‚úÖ Preload complete! ${loadedCount} loaded, ${errorCount} failed`);
                    }
                };

                // B·∫Øt ƒë·∫ßu t·∫£i ·∫£nh
                img.src = url;
            });
        }

        // H√†m x√≥a cache ·∫£nh (g·ªçi khi c·∫ßn)
        function clearImageCache() {
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ action: 'clearImageCache' });
            }
        }

        /* ======================= DOUBLE-CLICK/TAP TO CLOSE PANELS ======================= */
        // Bi·∫øn theo d√µi double-tap cho mobile
        let lastTapTime = 0;
        const DOUBLE_TAP_DELAY = 300; // ms

        // H√†m ki·ªÉm tra click c√≥ n·∫±m ngo√†i panel kh√¥ng
        function isOutsidePanel(target) {
            const cartPanel = document.getElementById('cartPanel');
            const orderedPanel = document.getElementById('orderedPanel');
            const aiChatPanel = document.getElementById('aiChatPanel');

            // Kh√¥ng ƒë√≥ng n·∫øu click v√†o c√°c panel ho·∫∑c c√°c n√∫t ƒëi·ªÅu khi·ªÉn
            if (cartPanel.contains(target) ||
                orderedPanel.contains(target) ||
                (aiChatPanel && aiChatPanel.contains(target)) ||
                target.closest('#cartBtn') ||
                target.closest('#orderedBtn') ||
                target.closest('#aiChatBtn') ||
                target.closest('.header-controls')) {
                return false;
            }
            return true;
        }

        // H√†m ƒë√≥ng c√°c panel ƒëang m·ªü
        function closePanelsIfOpen() {
            const cartPanel = document.getElementById('cartPanel');
            const orderedPanel = document.getElementById('orderedPanel');
            let closed = false;

            if (cartPanel.classList.contains('show')) {
                cartPanel.classList.remove('show');
                closed = true;
            }
            if (orderedPanel.classList.contains('show')) {
                orderedPanel.classList.remove('show');
                closed = true;
            }
            return closed;
        }

        // Double-click ƒë·ªÉ ƒë√≥ng (Desktop)
        document.addEventListener('dblclick', function (e) {
            if (isOutsidePanel(e.target)) {
                closePanelsIfOpen();
            }
        });

        // Double-tap ƒë·ªÉ ƒë√≥ng (Mobile/Touch)
        document.addEventListener('touchend', function (e) {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTapTime;

            if (tapLength < DOUBLE_TAP_DELAY && tapLength > 0) {
                // Double-tap detected
                if (isOutsidePanel(e.target)) {
                    e.preventDefault(); // NgƒÉn zoom tr√™n mobile
                    closePanelsIfOpen();
                }
            }
            lastTapTime = currentTime;
        });
    </script>

</body>

</html>
